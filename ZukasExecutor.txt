-- === Secure Access Code Prompt ===
local ACCESS_CODES = {
    ["root"] = true, -- Replace with your code
    ["root"] = true,  -- Add more codes for friends
    ["root"] = true
}
local function showAccessPrompt()
    local sg = Instance.new("ScreenGui")
    sg.Name = "ZukaAccessPrompt"
    sg.ResetOnSpawn = false
    sg.Parent = game.CoreGui
    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0, 340, 0, 140)
    frame.Position = UDim2.new(0.5, -170, 0.5, -70)
    frame.BackgroundColor3 = Color3.fromRGB(30,30,40)
    frame.BorderSizePixel = 0
    local corner = Instance.new("UICorner", frame)
    corner.CornerRadius = UDim.new(0, 10)
    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(1, -24, 0, 36)
    label.Position = UDim2.new(0, 12, 0, 10)
    label.BackgroundTransparency = 1
    label.Text = "Developer Key"
    label.Font = Enum.Font.Code
    label.TextSize = 18
    label.TextColor3 = Color3.fromRGB(200,220,255)
    label.TextXAlignment = Enum.TextXAlignment.Left
    local box = Instance.new("TextBox", frame)
    box.Size = UDim2.new(1, -24, 0, 36)
    box.Position = UDim2.new(0, 12, 0, 56)
    box.BackgroundColor3 = Color3.fromRGB(40,40,60)
    box.TextColor3 = Color3.fromRGB(255,255,255)
    box.Font = Enum.Font.Code
    box.TextSize = 18
    box.PlaceholderText = "Enter Key.."
    box.Text = ""
    local okBtn = Instance.new("TextButton", frame)
    okBtn.Size = UDim2.new(0, 120, 0, 32)
    okBtn.Position = UDim2.new(1, -132, 1, -42)
    okBtn.BackgroundColor3 = Color3.fromRGB(60,120,200)
    okBtn.TextColor3 = Color3.fromRGB(255,255,255)
    okBtn.Font = Enum.Font.Code
    okBtn.TextSize = 16
    okBtn.Text = "Enter"
    local okCorner = Instance.new("UICorner", okBtn)
    okCorner.CornerRadius = UDim.new(0, 6)
    local result = Instance.new("TextLabel", frame)
    result.Size = UDim2.new(1, -24, 0, 20)
    result.Position = UDim2.new(0, 12, 1, -20)
    result.BackgroundTransparency = 1
    result.Text = ""
    result.Font = Enum.Font.Code
    result.TextSize = 14
    result.TextColor3 = Color3.fromRGB(255,80,80)
    result.TextXAlignment = Enum.TextXAlignment.Left
    local accessGranted = false
    local function tryAccess()
        local code = box.Text
        if ACCESS_CODES[code] then
            accessGranted = true
            sg:Destroy()
        else
            result.Text = "Wrong code. Try again."
        end
    end
    okBtn.MouseButton1Click:Connect(tryAccess)
    box.FocusLost:Connect(function(enter)
        if enter then tryAccess() end
    end)
    repeat wait() until accessGranted
end

showAccessPrompt()

if getgenv().ZukaLuaHub then
    pcall(function() getgenv().ZukaLuaHub:Destroy() end)
    getgenv().ZukaLuaHub = nil
end

-- Services
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Simple notify helper
local function notify(title, text, duration)
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {
            Title = title,
            Text = text,
            Duration = duration or 3
        })
    end)
end

-- Create ScreenGui
local screen = Instance.new("ScreenGui")
screen.Name = "ZukaLuaHub"
screen.ResetOnSpawn = false
screen.Parent = game.CoreGui
getgenv().ZukaLuaHub = screen

-- Helpers: styling & tween
local function makeUICorner(parent, radius)
    local c = Instance.new("UICorner", parent)
    c.CornerRadius = UDim.new(0, radius or 6)
    return c
end
local function tween(obj, props, t)
    TweenService:Create(obj, TweenInfo.new(t or 0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props):Play()
end
local function makeButton(parent, text, size, pos, callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = size
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(45,45,45)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.Code
    btn.TextSize = 14
    btn.Text = text
    makeUICorner(btn, 6)
    btn.MouseEnter:Connect(function() tween(btn, {BackgroundColor3 = Color3.fromRGB(65,65,65)}) end)
    btn.MouseLeave:Connect(function() tween(btn, {BackgroundColor3 = Color3.fromRGB(45,45,45)}) end)
    btn.MouseButton1Click:Connect(function() pcall(callback, btn) end)
    return btn
end

-- Main window
local MainFrame = Instance.new("Frame", screen)
MainFrame.Size = UDim2.new(0, 740, 0, 420)
MainFrame.Position = UDim2.new(0.5, -370, 0.5, -210)
MainFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
MainFrame.BackgroundTransparency = 0.13
MainFrame.BorderSizePixel = 0
makeUICorner(MainFrame, 10)

-- Titlebar
local TitleBar = Instance.new("Frame", MainFrame)
TitleBar.Size = UDim2.new(1, 0, 0, 36)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundColor3 = Color3.fromRGB(35,35,35)
TitleBar.BackgroundTransparency = 0.16
makeUICorner(TitleBar, 10)

local TitleLabel = Instance.new("TextLabel", TitleBar)
TitleLabel.Size = UDim2.new(1, -160, 1, 0)
TitleLabel.Position = UDim2.new(0, 12, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Zuka's Hub"
TitleLabel.Font = Enum.Font.Code
TitleLabel.TextSize = 16
TitleLabel.TextColor3 = Color3.fromRGB(255,255,255)
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

local CloseBtn = makeButton(TitleBar, "Close", UDim2.new(0,70,0,24), UDim2.new(1, -80, 0, 6), function()
    if getgenv().ZukaLuaHub then
        pcall(function() getgenv().ZukaLuaHub:Destroy() end)
        getgenv().ZukaLuaHub = nil
    end
end)
local MinBtn = makeButton(TitleBar, "￢ﾀﾓ", UDim2.new(0,30,0,24), UDim2.new(1, -120, 0, 6), nil)

-- Manual dragging (robust)
do
    local dragging, dragStart, startPos
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- Tabs area + pages
local TabsColumn = Instance.new("Frame", MainFrame)
TabsColumn.Size = UDim2.new(0, 120, 1, -36)
TabsColumn.Position = UDim2.new(0, 0, 0, 36)
TabsColumn.BackgroundColor3 = Color3.fromRGB(28,28,28)
TabsColumn.BackgroundTransparency = 0.18
makeUICorner(TabsColumn, 8)

local PagesArea = Instance.new("Frame", MainFrame)
PagesArea.Size = UDim2.new(1, -120, 1, -36)
PagesArea.Position = UDim2.new(0, 120, 0, 36)
PagesArea.BackgroundTransparency = 1

local pages = {}
local function createPage(name)
    local p = Instance.new("Frame", PagesArea)
    p.Size = UDim2.new(1,0,1,0)
    p.BackgroundTransparency = 1
    p.Visible = false
    pages[name] = p
    return p
end

local EditorPage = createPage("Editor")
local CommandsPage = createPage("Commands")
local SpecialPage = createPage("Special")
local InfoPage = createPage("Info")
local AimbotPage = createPage("Aimbot")
local ExtenderPage = createPage("Extender")

-- Tab helper
local function switchPage(name)
    for k,v in pairs(pages) do v.Visible = (k == name) end
    -- highlight active tab
    for _, child in pairs(TabsColumn:GetChildren()) do
        if child:IsA("TextButton") then child.BackgroundColor3 = Color3.fromRGB(45,45,45) end
    end
    local tabBtn = TabsColumn:FindFirstChild(name .. "_Tab")
    if tabBtn then tabBtn.BackgroundColor3 = Color3.fromRGB(80,80,80) end
end

local function makeTab(name, y)
    local btn = makeButton(TabsColumn, name, UDim2.new(1, -16, 0, 44), UDim2.new(0, 8, 0, y), function() switchPage(name) end)
    btn.Name = name .. "_Tab"
    return btn
end

makeTab("Editor", 12)
makeTab("Commands", 12 + 44 + 6)
makeTab("Special", 12 + 2 * (44 + 6))
makeTab("Info", 12 + 3 * (44 + 6))
makeTab("Aimbot", 12 + 4 * (44 + 6))
makeTab("Rage Bot", 12 + 5 * (44 + 6))
makeTab("Zuka Bot", 12 + 6 * (44 + 6))
switchPage("Editor")
-- ========== Zuka Bot Page ========== 
do
    local ZukaBotPage = createPage("Zuka Bot")
    local page = ZukaBotPage
    local title = Instance.new("TextLabel", page)
    title.Size = UDim2.new(1, -20, 0, 36)
    title.Position = UDim2.new(0, 10, 0, 10)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(120,200,255)
    title.Font = Enum.Font.Code
    title.TextSize = 22
    title.Text = "Zukas Follow Bot"
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextYAlignment = Enum.TextYAlignment.Center

    local desc = Instance.new("TextLabel", page)
    desc.Size = UDim2.new(1, -20, 0, 22)
    desc.Position = UDim2.new(0, 10, 0, 50)
    desc.BackgroundTransparency = 1
    desc.TextColor3 = Color3.fromRGB(180,220,255)
    desc.Font = Enum.Font.Code
    desc.TextSize = 15
    desc.Text = "This turns you into a personal follow bot"
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.TextYAlignment = Enum.TextYAlignment.Center

    local followToggle = Instance.new("TextButton", page)
    followToggle.Size = UDim2.new(0, 160, 0, 32)
    followToggle.Position = UDim2.new(0, 20, 0, 90)
    followToggle.BackgroundColor3 = Color3.fromRGB(40,40,40)
    followToggle.TextColor3 = Color3.fromRGB(255,255,255)
    followToggle.Font = Enum.Font.Code
    followToggle.TextSize = 16
    followToggle.Text = "Auto Follow: OFF"
    makeUICorner(followToggle, 6)

    -- Teleport button
    local teleportBtn = Instance.new("TextButton", page)
    teleportBtn.Size = UDim2.new(0, 160, 0, 32)
    teleportBtn.Position = UDim2.new(1, -180, 0, 90)
    teleportBtn.AnchorPoint = Vector2.new(0, 0)
    teleportBtn.BackgroundColor3 = Color3.fromRGB(60,120,200)
    teleportBtn.TextColor3 = Color3.fromRGB(255,255,255)
    teleportBtn.Font = Enum.Font.Code
    teleportBtn.TextSize = 16
    teleportBtn.Text = "Teleport to OverZuka"
    makeUICorner(teleportBtn, 6)
    teleportBtn.MouseButton1Click:Connect(function()
        local target = Players:FindFirstChild("OverZuka")
        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            local myChar = LocalPlayer.Character
            if myChar and myChar:FindFirstChild("HumanoidRootPart") then
                myChar.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -7.5)
                notify("Zuka Bot", "Teleported to OverZuka!", 2)
            else
                notify("Zuka Bot", "Your character is not loaded!", 2)
            end
        else
            notify("Zuka Bot", "OverZuka is not in the game!", 2)
        end
    end)

    local followEnabled = false
    followToggle.MouseButton1Click:Connect(function()
        followEnabled = not followEnabled
        followToggle.Text = "Auto Follow: " .. (followEnabled and "ON" or "OFF")
    end)

    local followDist = 7.5 -- Increased to keep a comfortable gap
    RunService.RenderStepped:Connect(function()
        if followEnabled then
            local target = Players:FindFirstChild("OverZuka")
            if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                local myChar = LocalPlayer.Character
                if myChar and myChar:FindFirstChild("HumanoidRootPart") and myChar:FindFirstChild("Humanoid") and myChar.Humanoid.Health > 0 then
                    local targetHRP = target.Character.HumanoidRootPart
                    local myHRP = myChar.HumanoidRootPart
                    local offset = (targetHRP.Position - myHRP.Position)
                    local dist = offset.Magnitude
                    if dist < followDist - 1 then
                        -- Too close, step back
                        myHRP.CFrame = CFrame.new(myHRP.Position - offset.Unit * 0.5, targetHRP.Position)
                    elseif dist > followDist + 1 then
                        -- Too far, move closer
                        local direction = offset.Unit
                        local desiredPos = targetHRP.Position - direction * followDist
                        myHRP.CFrame = CFrame.new(desiredPos, targetHRP.Position)
                    end
                end
            end
        end
    end)
end

-- ========== Rage Bot Page ========== 
do
    local RageBotPage = createPage("Rage Bot") -- Patched: Was "Fun", now matches tab
    local page = RageBotPage
    local title = Instance.new("TextLabel", page)
    title.Size = UDim2.new(1, -20, 0, 36)
    title.Position = UDim2.new(0, 10, 0, 10)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(255,80,80)
    title.Font = Enum.Font.Code
    title.TextSize = 22
    title.Text = "Rage Bot"
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextYAlignment = Enum.TextYAlignment.Center

    local desc = Instance.new("TextLabel", page)
    desc.Size = UDim2.new(1, -20, 0, 22)
    desc.Position = UDim2.new(0, 10, 0, 50)
    desc.BackgroundTransparency = 1
    desc.TextColor3 = Color3.fromRGB(220,180,180)
    desc.Font = Enum.Font.Code
    desc.TextSize = 15
    desc.Text = "Automatically hovers behind and attacks the noob selected."
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.TextYAlignment = Enum.TextYAlignment.Center

    -- Player list
    local playerListLabel = Instance.new("TextLabel", page)
    playerListLabel.Size = UDim2.new(0, 120, 0, 22)
    playerListLabel.Position = UDim2.new(0, 20, 0, 90)
    playerListLabel.BackgroundTransparency = 1
    playerListLabel.Text = "Player List:"
    playerListLabel.TextColor3 = Color3.fromRGB(255,180,180)
    playerListLabel.Font = Enum.Font.Code
    playerListLabel.TextSize = 15
    playerListLabel.TextXAlignment = Enum.TextXAlignment.Left
    playerListLabel.TextYAlignment = Enum.TextYAlignment.Center

    local playerDropdown = Instance.new("TextButton", page)
    playerDropdown.Size = UDim2.new(0, 180, 0, 28)
    playerDropdown.Position = UDim2.new(0, 140, 0, 90)
    playerDropdown.BackgroundColor3 = Color3.fromRGB(40,40,40)
    playerDropdown.TextColor3 = Color3.fromRGB(255,255,255)
    playerDropdown.Font = Enum.Font.Code
    playerDropdown.TextSize = 15
    playerDropdown.Text = "Select Player"
    makeUICorner(playerDropdown, 6)

    local selectedPlayer = nil
    local function refreshPlayerList()
        local names = {}
        for _,plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer then table.insert(names, plr.Name) end
        end
        playerDropdown.Text = #names > 0 and ("Select Player: "..names[1]) or "No Players"
        selectedPlayer = #names > 0 and Players:FindFirstChild(names[1]) or nil
        playerDropdown.MouseButton1Click:Connect(function()
            local idx = table.find(names, selectedPlayer and selectedPlayer.Name or "") or 1
            idx = idx + 1; if idx > #names then idx = 1 end
            selectedPlayer = Players:FindFirstChild(names[idx])
            playerDropdown.Text = selectedPlayer and ("Select Player: "..selectedPlayer.Name) or "No Players"
        end)
    end
    refreshPlayerList()
    Players.PlayerAdded:Connect(refreshPlayerList)
    Players.PlayerRemoving:Connect(refreshPlayerList)

    -- Rage Bot toggles
    local rageToggle = Instance.new("TextButton", page)
    rageToggle.Size = UDim2.new(0, 160, 0, 32)
    rageToggle.Position = UDim2.new(0, 20, 0, 130)
    rageToggle.BackgroundColor3 = Color3.fromRGB(40,40,40)
    rageToggle.TextColor3 = Color3.fromRGB(255,255,255)
    rageToggle.Font = Enum.Font.Code
    rageToggle.TextSize = 16
    rageToggle.Text = "Rage Bot: OFF"
    makeUICorner(rageToggle, 6)

    local rageEnabled = false
    rageToggle.MouseButton1Click:Connect(function()
        rageEnabled = not rageEnabled
        rageToggle.Text = "Rage Bot: " .. (rageEnabled and "ON" or "OFF")
    end)

    -- Hover distance
    local hoverLabel = Instance.new("TextLabel", page)
    hoverLabel.Size = UDim2.new(0, 120, 0, 22)
    hoverLabel.Position = UDim2.new(0, 20, 0, 170)
    hoverLabel.BackgroundTransparency = 1
    hoverLabel.Text = "Hover Distance:"
    hoverLabel.TextColor3 = Color3.fromRGB(255,180,180)
    hoverLabel.Font = Enum.Font.Code
    hoverLabel.TextSize = 15
    hoverLabel.TextXAlignment = Enum.TextXAlignment.Left
    hoverLabel.TextYAlignment = Enum.TextYAlignment.Center

    local hoverBox = Instance.new("TextBox", page)
    hoverBox.Size = UDim2.new(0, 80, 0, 22)
    hoverBox.Position = UDim2.new(0, 140, 0, 170)
    hoverBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
    hoverBox.TextColor3 = Color3.fromRGB(255,255,255)
    hoverBox.Font = Enum.Font.Code
    hoverBox.TextSize = 15
    hoverBox.Text = "6"
    hoverBox.PlaceholderText = "Studs..."
    makeUICorner(hoverBox, 6)
    local hoverDist = 6
    hoverBox.FocusLost:Connect(function()
        local val = tonumber(hoverBox.Text)
        if val and val >= 2 and val <= 20 then
            hoverDist = val
            hoverBox.Text = tostring(hoverDist)
        else
            hoverBox.Text = tostring(hoverDist)
        end
    end)

    -- Rage Bot logic
    RunService.RenderStepped:Connect(function()
        if rageEnabled and selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local myChar = LocalPlayer.Character
            if myChar and myChar:FindFirstChild("HumanoidRootPart") and myChar:FindFirstChild("Humanoid") and myChar.Humanoid.Health > 0 then
                local targetHRP = selectedPlayer.Character.HumanoidRootPart
                local myHRP = myChar.HumanoidRootPart
                -- Position behind target
                local backVec = -targetHRP.CFrame.LookVector * hoverDist
                myHRP.CFrame = CFrame.new(targetHRP.Position + backVec, targetHRP.Position)
                -- Auto-aim (face target)
                myHRP.CFrame = CFrame.new(myHRP.Position, targetHRP.Position)
                -- Auto-attack (simulate click)
                local tool = myChar:FindFirstChildOfClass("Tool")
                if tool and tool:FindFirstChild("Handle") then
                    pcall(function()
                        tool:Activate()
                    end)
                end
            end
        end
    end)
end
-- ========== Aimbot Page ========== 
do
    local page = AimbotPage
    local title = Instance.new("TextLabel", page)
    title.Size = UDim2.new(1, -20, 0, 36)
    title.Position = UDim2.new(0, 10, 0, 10)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(200,220,255)
    title.Font = Enum.Font.Code
    title.TextSize = 22
    title.Text = "Aimbot Options"
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextYAlignment = Enum.TextYAlignment.Center

    local desc = Instance.new("TextLabel", page)
    desc.Size = UDim2.new(1, -20, 0, 22)
    desc.Position = UDim2.new(0, 10, 0, 50)
    desc.BackgroundTransparency = 1
    desc.TextColor3 = Color3.fromRGB(180,180,200)
    desc.Font = Enum.Font.Code
    desc.TextSize = 15
    desc.Text = "Configure aimbot toggle and aim part."
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.TextYAlignment = Enum.TextYAlignment.Center

    -- Toggle key
    local toggleKeyLabel = Instance.new("TextLabel", page)
    toggleKeyLabel.Size = UDim2.new(0, 120, 0, 22)
    toggleKeyLabel.Position = UDim2.new(0, 20, 0, 90)
    toggleKeyLabel.BackgroundTransparency = 1
    toggleKeyLabel.Text = "Toggle Key:"
    toggleKeyLabel.TextColor3 = Color3.fromRGB(180,220,255)
    toggleKeyLabel.Font = Enum.Font.Code
    toggleKeyLabel.TextSize = 15
    toggleKeyLabel.TextXAlignment = Enum.TextXAlignment.Left
    toggleKeyLabel.TextYAlignment = Enum.TextYAlignment.Center

    local toggleKeyBox = Instance.new("TextBox", page)
    toggleKeyBox.Size = UDim2.new(0, 80, 0, 22)
    toggleKeyBox.Position = UDim2.new(0, 140, 0, 90)
    toggleKeyBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
    toggleKeyBox.TextColor3 = Color3.fromRGB(255,255,255)
    toggleKeyBox.Font = Enum.Font.Code
    toggleKeyBox.TextSize = 15
    toggleKeyBox.Text = "MouseButton2"
    toggleKeyBox.PlaceholderText = "Key..."
    makeUICorner(toggleKeyBox, 6)

    -- Part to aim at
    local partLabel = Instance.new("TextLabel", page)
    partLabel.Size = UDim2.new(0, 120, 0, 22)
    partLabel.Position = UDim2.new(0, 20, 0, 130)
    partLabel.BackgroundTransparency = 1
    partLabel.Text = "Aim Part:"
    partLabel.TextColor3 = Color3.fromRGB(180,220,255)
    partLabel.Font = Enum.Font.Code
    partLabel.TextSize = 15
    partLabel.TextXAlignment = Enum.TextXAlignment.Left
    partLabel.TextYAlignment = Enum.TextYAlignment.Center

    local partDropdown = Instance.new("TextButton", page)
    partDropdown.Size = UDim2.new(0, 120, 0, 22)
    partDropdown.Position = UDim2.new(0, 140, 0, 130)
    partDropdown.BackgroundColor3 = Color3.fromRGB(40,40,40)
    partDropdown.TextColor3 = Color3.fromRGB(255,255,255)
    partDropdown.Font = Enum.Font.Code
    partDropdown.TextSize = 15
    partDropdown.Text = "Head"
    makeUICorner(partDropdown, 6)

    local parts = {"Head", "HumanoidRootPart", "Torso", "UpperTorso", "LowerTorso"}
    local dropdownOpen = false
    local dropdownFrame

    partDropdown.MouseButton1Click:Connect(function()
        if dropdownOpen then
            if dropdownFrame then dropdownFrame:Destroy() end
            dropdownOpen = false
            return
        end
        dropdownOpen = true
        dropdownFrame = Instance.new("Frame", page)
        dropdownFrame.Size = UDim2.new(0, 120, 0, #parts * 22)
        dropdownFrame.Position = UDim2.new(0, 140, 0, 152)
        dropdownFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
        dropdownFrame.BorderSizePixel = 0
        makeUICorner(dropdownFrame, 6)
        for i, part in ipairs(parts) do
            local btn = Instance.new("TextButton", dropdownFrame)
            btn.Size = UDim2.new(1, 0, 0, 22)
            btn.Position = UDim2.new(0, 0, 0, (i-1)*22)
            btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
            btn.TextColor3 = Color3.fromRGB(255,255,255)
            btn.Font = Enum.Font.Code
            btn.TextSize = 15
            btn.Text = part
            btn.AutoButtonColor = true
            makeUICorner(btn, 6)
            btn.MouseButton1Click:Connect(function()
                partDropdown.Text = part
                dropdownFrame:Destroy()
                dropdownOpen = false
            end)
        end
    end)

    -- Status label
    local statusLabel = Instance.new("TextLabel", page)
    statusLabel.Size = UDim2.new(1, -20, 0, 22)
    statusLabel.Position = UDim2.new(0, 10, 0, 180)
    statusLabel.BackgroundTransparency = 1
    statusLabel.TextColor3 = Color3.fromRGB(180,220,180)
    statusLabel.Font = Enum.Font.Code
    statusLabel.TextSize = 15
    statusLabel.Text = "Aimbot ready. Hold toggle key to aim."
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.TextYAlignment = Enum.TextYAlignment.Center

    -- Select any block/humanoid by pressing V
    local selectLabel = Instance.new("TextLabel", page)
    selectLabel.Size = UDim2.new(1, -20, 0, 22)
    selectLabel.Position = UDim2.new(0, 10, 0, 210)
    selectLabel.BackgroundTransparency = 1
    selectLabel.TextColor3 = Color3.fromRGB(220,220,180)
    selectLabel.Font = Enum.Font.Code
    selectLabel.TextSize = 15
    selectLabel.Text = "Press V to select any block/humanoid under the mouse."
    selectLabel.TextXAlignment = Enum.TextXAlignment.Left
    selectLabel.TextYAlignment = Enum.TextYAlignment.Center

    local selectedTarget = nil
    local selectedPlayerTarget = nil
    local selectedNpcTarget = nil
    local selectedPart = nil -- specific part selected (player/NPC/block)
    local playerTargetEnabled = false

    -- Player list UI
    local playerListLabel = Instance.new("TextLabel", page)
    playerListLabel.Size = UDim2.new(0, 120, 0, 22)
    playerListLabel.Position = UDim2.new(0, 280, 0, 90)
    playerListLabel.BackgroundTransparency = 1
    playerListLabel.Text = "Player List:"
    playerListLabel.TextColor3 = Color3.fromRGB(180,220,255)
    playerListLabel.Font = Enum.Font.Code
    playerListLabel.TextSize = 15
    playerListLabel.TextXAlignment = Enum.TextXAlignment.Left
    playerListLabel.TextYAlignment = Enum.TextYAlignment.Center

    local playerDropdown = Instance.new("TextButton", page)
    playerDropdown.Size = UDim2.new(0, 160, 0, 22)
    playerDropdown.Position = UDim2.new(0, 400, 0, 90)
    playerDropdown.BackgroundColor3 = Color3.fromRGB(40,40,40)
    playerDropdown.TextColor3 = Color3.fromRGB(255,255,255)
    playerDropdown.Font = Enum.Font.Code
    playerDropdown.TextSize = 15
    playerDropdown.Text = "None"
    makeUICorner(playerDropdown, 6)

    local playerDropdownOpen = false
    local playerDropdownFrame

    local function buildPlayerDropdownFrame()
        if playerDropdownFrame then playerDropdownFrame:Destroy() playerDropdownFrame = nil end
        local playersList = Players:GetPlayers()
        playerDropdownFrame = Instance.new("Frame", page)
        playerDropdownFrame.Size = UDim2.new(0, 160, 0, (#playersList) * 22)
        playerDropdownFrame.Position = UDim2.new(0, 400, 0, 112)
        playerDropdownFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
        playerDropdownFrame.BorderSizePixel = 0
        makeUICorner(playerDropdownFrame, 6)
        for i, plr in ipairs(playersList) do
            local btn = Instance.new("TextButton", playerDropdownFrame)
            btn.Size = UDim2.new(1, 0, 0, 22)
            btn.Position = UDim2.new(0, 0, 0, (i-1)*22)
            btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
            btn.TextColor3 = Color3.fromRGB(255,255,255)
            btn.Font = Enum.Font.Code
            btn.TextSize = 15
            btn.Text = plr.Name
            btn.AutoButtonColor = true
            makeUICorner(btn, 6)
            btn.MouseButton1Click:Connect(function()
                selectedPlayerTarget = plr
                playerDropdown.Text = plr.Name
                if playerDropdownFrame then playerDropdownFrame:Destroy() end
                playerDropdownOpen = false
                if playerTargetEnabled then
                    statusLabel.Text = "Aimbot: Will target " .. plr.Name
                end
                -- show ESP immediately
                showSelectedPlayerESP(plr)
            end)
        end
    end

    -- Toggle to target selected player
    local targetPlayerToggle = Instance.new("TextButton", page)
    targetPlayerToggle.Size = UDim2.new(0, 140, 0, 32)
    targetPlayerToggle.Position = UDim2.new(0, 280, 0, 122)
    targetPlayerToggle.BackgroundColor3 = Color3.fromRGB(40,40,40)
    targetPlayerToggle.TextColor3 = Color3.fromRGB(255,255,255)
    targetPlayerToggle.Font = Enum.Font.Code
    targetPlayerToggle.TextSize = 15
    targetPlayerToggle.Text = "Target Selected: OFF"
    makeUICorner(targetPlayerToggle, 6)
    targetPlayerToggle.MouseButton1Click:Connect(function()
        playerTargetEnabled = not playerTargetEnabled
        targetPlayerToggle.Text = "Target Selected: " .. (playerTargetEnabled and "ON" or "OFF")
        if not playerTargetEnabled then
            selectedPlayerTarget = nil
            playerDropdown.Text = "None"
        end
    end)

    -- Build dropdown when clicked (auto-refreshing)
    playerDropdown.MouseButton1Click:Connect(function()
        if playerDropdownOpen then
            if playerDropdownFrame then playerDropdownFrame:Destroy() end
            playerDropdownOpen = false
            return
        end
        playerDropdownOpen = true
        buildPlayerDropdownFrame()
    end)

    -- Update list on player join/leave
    Players.PlayerAdded:Connect(function()
        if playerDropdownOpen then buildPlayerDropdownFrame() end
    end)
    Players.PlayerRemoving:Connect(function(plr)
        if selectedPlayerTarget == plr then
            selectedPlayerTarget = nil
            playerDropdown.Text = "None"
            playerTargetEnabled = false
            targetPlayerToggle.Text = "Target Selected: OFF"
            clearSelectedPlayerESP()
        end
        if playerDropdownOpen then buildPlayerDropdownFrame() end
    end)
    UIS.InputBegan:Connect(function(input, processed)
        if processed then return end
        if input.KeyCode == Enum.KeyCode.V then
            if selectedTarget or selectedPlayerTarget or selectedNpcTarget or selectedPart then
                selectedTarget, selectedPlayerTarget, selectedNpcTarget, selectedPart, currentTarget = nil, nil, nil, nil, nil
                statusLabel.Text = "Selection cleared."
                clearESP(); clearSelectedPlayerESP(); clearSelectedPartESP()
            else
                local mouse = LocalPlayer:GetMouse()
                local target = mouse.Target
                if target then
                    local modelAncestor = target:FindFirstAncestorOfClass("Model")
                    if modelAncestor and modelAncestor:FindFirstChildOfClass("Humanoid") then
                        local partName = partDropdown.Text
                        local chosenPart = modelAncestor:FindFirstChild(partName) or target
                        selectedPart = chosenPart
                        local plr = Players:GetPlayerFromCharacter(modelAncestor)
                        if plr then
                            selectedPlayerTarget, playerDropdown.Text = plr, plr.Name
                            statusLabel.Text = "Selected player: " .. plr.Name; showSelectedPlayerESP(plr)
                        else
                            selectedNpcTarget, selectedTarget = modelAncestor, chosenPart
                            statusLabel.Text = "Selected NPC: " .. (modelAncestor.Name or tostring(modelAncestor)); showSelectedPartESP(chosenPart)
                        end
                    else
                        selectedTarget, selectedPart = target, target
                        statusLabel.Text = "Selected: " .. (target.Name or tostring(target)); showSelectedPartESP(target)
                    end
                else
                    statusLabel.Text = "No block/humanoid under mouse."
                end
            end
        end
    end)

    -- === Aimbot Logic ===
    local aiming = false
    local currentTarget = nil
    local espBox = nil
    local selectedPlayerEsp = nil
    local selectedPartEsp = nil
    local silentAimEnabled = false
    local fovRadius = 150 -- Default FOV radius

    -- FOV Circle
    local fovCircle = Drawing.new("Circle")
    fovCircle.Visible = true
    fovCircle.Radius = fovRadius
    fovCircle.Color = Color3.fromRGB(255, 255, 255)
    fovCircle.Thickness = 1
    fovCircle.Transparency = 0.5
    fovCircle.Filled = false
    fovCircle.NumSides = 64
    
    -- Helper: get closest player to mouse within FOV
    local function getClosestPlayer()
        local mouse = LocalPlayer:GetMouse()
        local mousePos = Vector2.new(mouse.X, mouse.Y)
        local minDist = math.huge
        local closest = nil
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild(partDropdown.Text) then
                local part = plr.Character[partDropdown.Text]
                local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
                    if dist < fovRadius and dist < minDist then
                        minDist = dist
                        closest = plr
                    end
                end
            end
        end
        return closest
    end

    local function showESP(target)
        if espBox then espBox:Destroy() espBox = nil end
        if not target or not target.Character or not target.Character:FindFirstChild(partDropdown.Text) then return end
        local part = target.Character[partDropdown.Text]
        espBox = Instance.new("BoxHandleAdornment")
        espBox.Name, espBox.Adornee, espBox.AlwaysOnTop, espBox.ZIndex = "AimbotESP", part, true, 10
        espBox.Size = part.Size or Vector3.new(2,2,1); espBox.Color3 = Color3.fromRGB(255, 80, 80)
        espBox.Transparency, espBox.Parent = 0.4, part
    end
    local function clearESP() if espBox then espBox:Destroy() espBox = nil end end

    local function showSelectedPlayerESP(plr)
        if selectedPlayerEsp then selectedPlayerEsp:Destroy() selectedPlayerEsp = nil end
        if not plr or not plr.Character or not plr.Character:FindFirstChild(partDropdown.Text) then return end
        local part = plr.Character[partDropdown.Text]
        selectedPlayerEsp = Instance.new("BoxHandleAdornment")
        selectedPlayerEsp.Name, selectedPlayerEsp.Adornee, selectedPlayerEsp.AlwaysOnTop, selectedPlayerEsp.ZIndex = "SelectedPlayerESP", part, true, 9
        selectedPlayerEsp.Size = part.Size or Vector3.new(2,2,1); selectedPlayerEsp.Color3 = Color3.fromRGB(90, 170, 255)
        selectedPlayerEsp.Transparency, selectedPlayerEsp.Parent = 0.25, part
    end
    local function clearSelectedPlayerESP() if selectedPlayerEsp then selectedPlayerEsp:Destroy() selectedPlayerEsp = nil end end

    local function showSelectedPartESP(part)
        if selectedPartEsp then selectedPartEsp:Destroy() selectedPartEsp = nil end
        if not part or not part:IsA("BasePart") then return end
        selectedPartEsp = Instance.new("BoxHandleAdornment")
        selectedPartEsp.Name, selectedPartEsp.Adornee, selectedPartEsp.AlwaysOnTop, selectedPartEsp.ZIndex = "SelectedPartESP", part, true, 9
        selectedPartEsp.Size = part.Size or Vector3.new(2,2,1); selectedPartEsp.Color3 = Color3.fromRGB(90, 200, 140)
        selectedPartEsp.Transparency, selectedPartEsp.Parent = 0.28, part
    end
    local function clearSelectedPartESP() if selectedPartEsp then selectedPartEsp:Destroy() selectedPartEsp = nil end end

    UIS.InputBegan:Connect(function(input, processed)
        if processed then return end
        local key = toggleKeyBox.Text:upper()
        if (key == "MOUSEBUTTON2" and input.UserInputType == Enum.UserInputType.MouseButton2) or (input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode.Name:upper() == key) then
            aiming = true
        end
    end)
    UIS.InputEnded:Connect(function(input)
        local key = toggleKeyBox.Text:upper()
        if (key == "MOUSEBUTTON2" and input.UserInputType == Enum.UserInputType.MouseButton2) or (input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode.Name:upper() == key) then
            aiming = false; clearESP()
        end
    end)

    RunService.RenderStepped:Connect(function()
        if selectedPlayerTarget and selectedPlayerTarget.Character and selectedPlayerTarget.Character:FindFirstChild(partDropdown.Text) then
            if not selectedPlayerEsp or selectedPlayerEsp.Adornee ~= selectedPlayerTarget.Character[partDropdown.Text] then showSelectedPlayerESP(selectedPlayerTarget) else
                local part = selectedPlayerTarget.Character[partDropdown.Text]; if selectedPlayerEsp and part then selectedPlayerEsp.Size, selectedPlayerEsp.Adornee = part.Size or Vector3.new(2,2,1), part end
            end
        else clearSelectedPlayerESP() end

        if selectedPart and selectedPart.Parent then
            if not selectedPartEsp or selectedPartEsp.Adornee ~= selectedPart then showSelectedPartESP(selectedPart) else
                selectedPartEsp.Size, selectedPartEsp.Adornee = selectedPart.Size or Vector3.new(2,2,1), selectedPart
            end
        else clearSelectedPartESP() end
        
        -- Update FOV circle
        local mouse = LocalPlayer:GetMouse()
        fovCircle.Position = Vector2.new(mouse.X, mouse.Y)
        fovCircle.Visible = not aiming and page.Visible

        if aiming then
            local target, part
            if playerTargetEnabled and selectedPlayerTarget and selectedPlayerTarget.Character and selectedPlayerTarget.Character:FindFirstChild(partDropdown.Text) then
                target, part = selectedPlayerTarget, selectedPlayerTarget.Character[partDropdown.Text]
            elseif selectedTarget then
                local parent = selectedTarget.Parent
                if parent and parent:IsA("Model") and parent:FindFirstChildOfClass("Humanoid") then
                    target, part = Players:GetPlayerFromCharacter(parent), selectedTarget
                else target, part = nil, selectedTarget end
            else
                target = getClosestPlayer()
                if target and target.Character and target.Character:FindFirstChild(partDropdown.Text) then part = target.Character[partDropdown.Text] end
            end

            if part and part.Parent then
                if target then currentTarget = target; showESP(target) end
                if silentAimEnabled then getgenv().ZukaSilentAimTarget = part.Position else
                    local cam = workspace.CurrentCamera
                    cam.CFrame = CFrame.new(cam.CFrame.Position, part.Position)
                end
                statusLabel.Text = "Aimbot: Targeting " .. (target and target.Name or part.Name)
            else clearESP(); statusLabel.Text = "Aimbot: No target" end
        else clearESP(); statusLabel.Text = "Aimbot ready. Hold toggle key to aim." end
    end)

    local silentAimToggle = Instance.new("TextButton", page)
    silentAimToggle.Size = UDim2.new(0, 180, 0, 32)
    silentAimToggle.Position = UDim2.new(0, 45, 0, 250)
    silentAimToggle.BackgroundColor3 = Color3.fromRGB(40,40,40)
    silentAimToggle.TextColor3 = Color3.fromRGB(255,255,255)
    silentAimToggle.Font = Enum.Font.Code
    silentAimToggle.TextSize = 15
    silentAimToggle.Text = "Silent Aim: OFF"
    makeUICorner(silentAimToggle, 6)
    silentAimToggle.MouseButton1Click:Connect(function()
        silentAimEnabled = not silentAimEnabled
        silentAimToggle.Text = "Silent Aim: " .. (silentAimEnabled and "ON" or "OFF")
    end)

    -- === FOV SLIDER AND CIRCLE (NEW) ===
    local fovLabel = Instance.new("TextLabel", page)
    fovLabel.Size = UDim2.new(0, 120, 0, 22)
    fovLabel.Position = UDim2.new(0, 45, 0, 290)
    fovLabel.BackgroundTransparency = 1
    fovLabel.Text = "FOV Radius:"
    fovLabel.TextColor3 = Color3.fromRGB(180,220,255)
    fovLabel.Font = Enum.Font.Code
    fovLabel.TextSize = 15
    fovLabel.TextXAlignment = Enum.TextXAlignment.Left
    fovLabel.TextYAlignment = Enum.TextYAlignment.Center

    local fovValueLabel = Instance.new("TextLabel", page)
    fovValueLabel.Size = UDim2.new(0, 40, 0, 22)
    fovValueLabel.Position = UDim2.new(0, 380, 0, 290)
    fovValueLabel.BackgroundTransparency = 1
    fovValueLabel.Text = tostring(fovRadius)
    fovValueLabel.TextColor3 = Color3.fromRGB(255,255,255)
    fovValueLabel.Font = Enum.Font.Code
    fovValueLabel.TextSize = 15
    fovValueLabel.TextXAlignment = Enum.TextXAlignment.Center
    fovValueLabel.TextYAlignment = Enum.TextYAlignment.Center

    local sliderBar = Instance.new("Frame", page)
    sliderBar.Size = UDim2.new(0, 200, 0, 6)
    sliderBar.Position = UDim2.new(0, 170, 0, 298)
    sliderBar.BackgroundColor3 = Color3.fromRGB(30,30,30)
    makeUICorner(sliderBar, 3)

    local sliderHandle = Instance.new("TextButton", sliderBar)
    sliderHandle.Size = UDim2.new(0, 16, 0, 16)
    sliderHandle.Position = UDim2.new(0.5, -8, 0.5, -8) -- Start in the middle
    sliderHandle.BackgroundColor3 = Color3.fromRGB(120, 140, 200)
    sliderHandle.Text = ""
    makeUICorner(sliderHandle, 8)
    
    local isDragging = false
    sliderHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then isDragging = true end
    end)
    sliderHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then isDragging = false end
    end)

    UIS.InputChanged:Connect(function(input)
        if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local minX = sliderBar.AbsolutePosition.X
            local maxX = minX + sliderBar.AbsoluteSize.X
            local mouseX = math.clamp(input.Position.X, minX, maxX)
            
            local percent = (mouseX - minX) / sliderBar.AbsoluteSize.X
            sliderHandle.Position = UDim2.new(percent, -8, 0.5, -8)
            
            local minFov, maxFov = 10, 500
            fovRadius = math.floor(minFov + (maxFov - minFov) * percent)
            fovCircle.Radius = fovRadius
            fovValueLabel.Text = tostring(fovRadius)
        end
    end)
end

-- Optimized IDE-style Editor Page
do
    --[[
        Optimizations Implemented:
        1. Efficient Gutter Updates: Line numbers are only recalculated when the line count changes,
           not on every keystroke. This drastically improves performance while typing.
        2. Reusable URL Popup: The URL popup is created once and its visibility is toggled,
           avoiding the overhead of creating/destroying instances repeatedly.
        3. Modular Structure: The entire editor is encapsulated within an 'Editor' table to
           organize variables and functions, preventing global namespace pollution.
        4. Debounced Layout Sync: Textbox and canvas resizing is handled cleanly to prevent
           excessive calculations during rapid text changes.
    ]]

    -- Services
    local RunService = game:GetService("RunService")

    -- Main Editor Module
    local Editor = {}
    Editor.lastLineCount = 0
    Editor.needsLayoutUpdate = false

    function Editor:Initialize(parent)
        -- Main Container
        self.editorBack = Instance.new("Frame", parent)
        self.editorBack.Size = UDim2.new(1, -20, 1, -20)
        self.editorBack.Position = UDim2.new(0, 10, 0, 10)
        self.editorBack.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
        self.editorBack.BackgroundTransparency = 0.13
        self.editorBack.ClipsDescendants = true
        makeUICorner(self.editorBack, 10)

        -- Gutter
        self.gutter = Instance.new("TextLabel", self.editorBack)
        self.gutter.Size = UDim2.new(0, 44, 1, -60)
        self.gutter.Position = UDim2.new(0, 0, 0, 0)
        self.gutter.BackgroundColor3 = Color3.fromRGB(24, 24, 32)
        self.gutter.BackgroundTransparency = 0.08
        self.gutter.TextColor3 = Color3.fromRGB(120, 140, 180)
        self.gutter.Font = Enum.Font.Code
        self.gutter.TextSize = 14
        self.gutter.TextXAlignment = Enum.TextXAlignment.Right
        self.gutter.TextYAlignment = Enum.TextYAlignment.Top
        self.gutter.Text = "1"
        self.gutter.ClipsDescendants = true
        makeUICorner(self.gutter, 6)

        -- Scrolling Frame
        self.scroller = Instance.new("ScrollingFrame", self.editorBack)
        self.scroller.Size = UDim2.new(1, -58, 1, -60)
        self.scroller.Position = UDim2.new(0, 50, 0, 0)
        self.scroller.BackgroundColor3 = Color3.fromRGB(22, 22, 28)
        self.scroller.BackgroundTransparency = 0.12
        self.scroller.BorderSizePixel = 0
        self.scroller.ScrollBarThickness = 8
        self.scroller.AutomaticCanvasSize = Enum.AutomaticSize.None
        makeUICorner(self.scroller, 7)
        pcall(function() self.scroller.ScrollBarImageColor3 = Color3.fromRGB(80, 120, 200) end)

        -- Main TextBox
        self.textBox = Instance.new("TextBox", self.scroller)
        self.textBox.Size = UDim2.new(1, -16, 0, 0) -- Y will be controlled by AutomaticSize
        self.textBox.Position = UDim2.new(0, 8, 0, 8)
        self.textBox.MultiLine = true
        self.textBox.ClearTextOnFocus = false
        self.textBox.TextXAlignment = Enum.TextXAlignment.Left
        self.textBox.TextYAlignment = Enum.TextYAlignment.Top
        self.textBox.Font = Enum.Font.Code
        self.textBox.TextSize = 15
        self.textBox.TextColor3 = Color3.fromRGB(235, 240, 255)
        self.textBox.PlaceholderText = "paste your epik script here..."
        self.textBox.BackgroundTransparency = 1
        self.textBox.TextWrapped = false
        self.textBox.AutomaticSize = Enum.AutomaticSize.Y
        self.textBox.Text = "-- Welcome to Zuka Hub! Optimized Edition."

        -- Bottom Action Bar
        self.bottomBar = Instance.new("Frame", self.editorBack)
        self.bottomBar.Size = UDim2.new(1, 0, 0, 50)
        self.bottomBar.Position = UDim2.new(0, 0, 1, -50)
        self.bottomBar.BackgroundColor3 = Color3.fromRGB(10, 10, 18)
        makeUICorner(self.bottomBar, 8)

        -- Initialize UI components and connections
        self:InitializeButtons()
        self:InitializeConnections()
        self:InitializeURLPopup()
        self:UpdateLayout() -- Initial layout calculation
    end

    function Editor:UpdateLayout()
        -- Calculate line count efficiently
        local lineCount = select(2, self.textBox.Text:gsub("\n", "")) + 1

        -- OPTIMIZATION: Only update the gutter text if the number of lines has changed.
        if lineCount ~= self.lastLineCount then
            local lineNumbers = table.create(lineCount)
            for i = 1, lineCount do
                lineNumbers[i] = tostring(i)
            end
            self.gutter.Text = table.concat(lineNumbers, "\n")
            self.lastLineCount = lineCount
        end

        -- Sync canvas size with the textbox's automatic size
        local textBounds = self.textBox.TextBounds
        self.scroller.CanvasSize = UDim2.new(0, 0, 0, textBounds.Y + 28)
        self.needsLayoutUpdate = false
    end

    function Editor:InitializeConnections()
        -- When text changes, flag that the layout needs an update
        self.textBox:GetPropertyChangedSignal("Text"):Connect(function()
            self.needsLayoutUpdate = true
        end)

        -- Use RenderStepped to check the flag, preventing updates on every single event fire
        RunService.RenderStepped:Connect(function()
            if self.needsLayoutUpdate then
                self:UpdateLayout()
            end
        end)
        
        -- Sync gutter scroll position
        self.scroller:GetPropertyChangedSignal("CanvasPosition"):Connect(function()
            self.gutter.Position = UDim2.new(0, 0, 0, -self.scroller.CanvasPosition.Y)
        end)
    end

    function Editor:InitializeButtons()
        makeButton(self.bottomBar, "Execute", UDim2.new(0, 100, 0, 34), UDim2.new(0, 10, 0, 8), function()
            local func, err = loadstring(self.textBox.Text)
            if not func then return notify("Zuka Hub", "Compile error: " .. tostring(err), 4) end
            local ok, res = pcall(func)
            if not ok then return notify("Zuka Hub", "Runtime error: " .. tostring(res), 4) end
            notify("Zuka Hub", "Executed", 2)
        end)

        makeButton(self.bottomBar, "Clear", UDim2.new(0, 100, 0, 34), UDim2.new(0, 120, 0, 8), function()
            self.textBox.Text = ""
            notify("Zuka Hub", "Editor cleared", 2)
        end)

        makeButton(self.bottomBar, "Save", UDim2.new(0, 100, 0, 34), UDim2.new(0, 230, 0, 8), function()
            if writefile then
                pcall(writefile, "ZukaHubScript.lua", self.textBox.Text)
                notify("Zuka Hub", "Saved", 2)
            else
                notify("Zuka Hub", "writefile not supported", 3)
            end
        end)

        makeButton(self.bottomBar, "Load", UDim2.new(0, 100, 0, 34), UDim2.new(0, 340, 0, 8), function()
            if readfile and isfile and isfile("ZukaHubScript.lua") then
                self.textBox.Text = readfile("ZukaHubScript.lua")
                notify("Zuka Hub", "Loaded", 2)
            else
                notify("Zuka Hub", "No saved file", 3)
            end
        end)

        makeButton(self.bottomBar, "From URL", UDim2.new(0, 100, 0, 34), UDim2.new(0, 450, 0, 8), function()
            self:ToggleURLPopup(true)
        end)
    end

    function Editor:InitializeURLPopup()
        self.urlPopup = Instance.new("Frame", self.editorBack)
        self.urlPopup.Size = UDim2.new(0, 400, 0, 150)
        self.urlPopup.Position = UDim2.new(0.5, -200, 0.5, -75)
        self.urlPopup.BackgroundColor3 = Color3.fromRGB(28, 28, 36)
        self.urlPopup.BorderSizePixel = 1
        self.urlPopup.BorderColor3 = Color3.fromRGB(60, 60, 80)
        self.urlPopup.ZIndex = 10
        self.urlPopup.Visible = false -- OPTIMIZATION: Create once, then toggle visibility
        makeUICorner(self.urlPopup, 10)

        local title = Instance.new("TextLabel", self.urlPopup)
        title.Size = UDim2.new(1, 0, 0, 40)
        title.Text = "Get Script From ScriptBlox"
        title.Font = Enum.Font.SourceSansBold
        title.TextSize = 18
        title.TextColor3 = Color3.fromRGB(220, 220, 240)
        title.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
        makeUICorner(title, 6)

        local urlInput = Instance.new("TextBox", self.urlPopup)
        urlInput.Size = UDim2.new(1, -20, 0, 35)
        urlInput.Position = UDim2.new(0, 10, 0, 50)
        urlInput.Font = Enum.Font.Code
        urlInput.PlaceholderText = "https://scriptblox.com/script/..."
        urlInput.ClearTextOnFocus = false
        makeUICorner(urlInput, 6)

        makeButton(self.urlPopup, "Close", UDim2.new(0, 80, 0, 34), UDim2.new(1, -90, 1, -44), function()
            self:ToggleURLPopup(false)
        end)

        makeButton(self.urlPopup, "Fetch", UDim2.new(0, 80, 0, 34), UDim2.new(1, -180, 1, -44), function()
            local url = urlInput.Text
            if not url:match("scriptblox.com/script/") then
                return notify("Zuka Hub", "Invalid ScriptBlox URL", 4)
            end
            
            notify("Zuka Hub", "Fetching script...", 2)
            local rawUrl = url:gsub("/script/", "/raw/")

            pcall(function()
                local response = syn.request({ Url = rawUrl, Method = "GET" })
                if response and response.Success then
                    self.textBox.Text = response.Body
                    notify("Zuka Hub", "Script loaded successfully!", 3)
                    self:ToggleURLPopup(false)
                else
                    notify("Zuka Hub", "Failed to fetch script.", 5)
                end
            end)
        end)
    end

    function Editor:ToggleURLPopup(visible)
        self.urlPopup.Visible = visible
    end

    -- Create the editor instance, assuming 'EditorPage' is the parent frame.
    Editor:Initialize(EditorPage)
end

-- ========== Info Page (Corrected & Optimized ScriptBlox Searcher) ==========

do
    local page = InfoPage
    local HttpService = game:GetService("HttpService")
    -- local LocalPlayer is already defined globally

    -- =================================================================
    -- ========= TOP SECTION: Original Game Info (Unchanged) =========
    -- =================================================================
    do
        local infoFrame = Instance.new("Frame", page)
        infoFrame.Size = UDim2.new(1, -20, 0, 140)
        infoFrame.Position = UDim2.new(0, 10, 0, 10)
        infoFrame.BackgroundTransparency = 1

        local title = Instance.new("TextLabel", infoFrame)
        title.Size = UDim2.new(1, 0, 0, 36)
        title.Position = UDim2.new(0, 0, 0, 0)
        title.BackgroundTransparency = 1
        title.TextColor3 = Color3.fromRGB(200, 220, 255)
        title.Font = Enum.Font.Code
        title.TextSize = 22
        title.Text = "Game & User Info"
        title.TextXAlignment = Enum.TextXAlignment.Left

        local profileLabel = Instance.new("TextLabel", infoFrame)
        profileLabel.Size = UDim2.new(1, 0, 0, 28)
        profileLabel.Position = UDim2.new(0, 0, 0, 46)
        profileLabel.BackgroundTransparency = 1
        profileLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
        profileLabel.Font = Enum.Font.Code
        profileLabel.TextSize = 15
        profileLabel.TextXAlignment = Enum.TextXAlignment.Left
        profileLabel.Text = string.format("User: %s (%s)", LocalPlayer.DisplayName, LocalPlayer.Name)

        local gameLabel = Instance.new("TextLabel", infoFrame)
        gameLabel.Size = UDim2.new(1, 0, 0, 24)
        gameLabel.Position = UDim2.new(0, 0, 0, 78)
        gameLabel.BackgroundTransparency = 1
        gameLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        gameLabel.Font = Enum.Font.Code
        gameLabel.TextSize = 14
        gameLabel.TextXAlignment = Enum.TextXAlignment.Left
        gameLabel.Text = "PlaceId: " .. tostring(game.PlaceId)

        local jobLabel = Instance.new("TextLabel", infoFrame)
        jobLabel.Size = UDim2.new(1, 0, 0, 24)
        jobLabel.Position = UDim2.new(0, 0, 0, 102)
        jobLabel.BackgroundTransparency = 1
        jobLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        jobLabel.Font = Enum.Font.Code
        jobLabel.TextSize = 14
        jobLabel.TextXAlignment = Enum.TextXAlignment.Left
        jobLabel.Text = "JobId: " .. tostring(game.JobId):sub(1, 36)
    end

    -- =================================================================
    -- ========= BOTTOM SECTION: Corrected ScriptBlox Searcher =========
    -- =================================================================
    do
        local searchFrame = Instance.new("Frame", page)
        searchFrame.Size = UDim2.new(1, -20, 1, -160)
        searchFrame.Position = UDim2.new(0, 10, 0, 150)
        searchFrame.BackgroundTransparency = 1

        local searchBox = Instance.new("TextBox", searchFrame)
        searchBox.Size = UDim2.new(1, -130, 0, 34)
        searchBox.Position = UDim2.new(0, 0, 0, 0)
        searchBox.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        searchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
        searchBox.Font = Enum.Font.Code
        searchBox.TextSize = 15
        searchBox.PlaceholderText = "Search for a game or script..."
        makeUICorner(searchBox, 6)

        local searchBtn = makeButton(searchFrame, "Search", UDim2.new(0, 120, 0, 34), UDim2.new(1, -120, 0, 0))

        local resultsScroller = Instance.new("ScrollingFrame", searchFrame)
        resultsScroller.Size = UDim2.new(1, 0, 1, -44)
        resultsScroller.Position = UDim2.new(0, 0, 0, 44)
        resultsScroller.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
        resultsScroller.BorderSizePixel = 0
        resultsScroller.ScrollBarThickness = 6
        resultsScroller.AutomaticCanvasSize = Enum.AutomaticSize.Y
        makeUICorner(resultsScroller, 8)

        local listLayout = Instance.new("UIListLayout", resultsScroller)
        listLayout.Padding = UDim.new(0, 5)
        listLayout.SortOrder = Enum.SortOrder.LayoutOrder

        local statusLabel = Instance.new("TextLabel", resultsScroller)
        statusLabel.Size = UDim2.new(1, -20, 0, 30)
        statusLabel.Position = UDim2.new(0, 10, 0, 10)
        statusLabel.BackgroundTransparency = 1
        statusLabel.Font = Enum.Font.Code
        statusLabel.TextSize = 16
        statusLabel.TextColor3 = Color3.fromRGB(150, 160, 180)
        statusLabel.Text = "Search for scripts from ScriptBlox."
        statusLabel.TextWrapped = true

        local resultTemplate = Instance.new("Frame")
        resultTemplate.Size = UDim2.new(1, 0, 0, 40)
        resultTemplate.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        resultTemplate.Visible = false
        makeUICorner(resultTemplate, 6)
        
        local titleLabel = Instance.new("TextLabel", resultTemplate)
        titleLabel.Size = UDim2.new(1, -100, 1, 0)
        titleLabel.Position = UDim2.new(0, 10, 0, 0)
        titleLabel.Name = "Title"
        titleLabel.BackgroundTransparency = 1
        titleLabel.Font = Enum.Font.Code
        titleLabel.TextSize = 14
        titleLabel.TextColor3 = Color3.fromRGB(230, 230, 240)
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left
        
        local execBtn = makeButton(resultTemplate, "Execute", UDim2.new(0, 80, 0, 28), UDim2.new(1, -90, 0.5, -14))
        execBtn.Name = "ExecButton"

        local function executeScript(scriptPath)
            notify("Searcher", "Fetching script...", 2)
            local rawUrl = "https://scriptblox.com" .. scriptPath:gsub("/script/", "/raw/")
            
            task.spawn(function()
                local success, response = pcall(function()
                    return syn.request({ Url = rawUrl, Method = "GET", Headers = {["User-Agent"] = "Mozilla/5.0"} })
                end)

                if success and response and response.Success and response.Body and response.Body ~= "" then
                    Editor.textBox.Text = response.Body 
                    notify("Searcher", "Script loaded into Editor!", 3)
                    switchPage("Editor")
                else
                    notify("Searcher", "Failed to fetch script content. It may have been deleted.", 5)
                end
            end)
        end
        
        local function handleSearch()
            local query = searchBox.Text
            if query:gsub("%s*", "") == "" then 
                return notify("Searcher", "Please enter a search term.", 3) 
            end
            
            -- Clear previous results and set status
            for _, child in ipairs(resultsScroller:GetChildren()) do
                if child:IsA("Frame") then child:Destroy() end
            end
            statusLabel.Visible = true
            statusLabel.Text = "Searching for '" .. query .. "'..."
            
            searchBtn.Text = "... Searching"
            searchBtn.Active = false -- Patched: Was .Enabled

            task.spawn(function()
                local success, response = pcall(function()
                    local encodedQuery = HttpService:UrlEncode(query)
                    local searchUrl = "https://scriptblox.com/search?q=" .. encodedQuery
                    return syn.request({ Url = searchUrl, Method = "GET", Headers = {["User-Agent"] = "Mozilla/5.0"} })
                end)
                
                searchBtn.Text = "Search"
                searchBtn.Active = true -- Patched: Was .Enabled

                if not success then
                    statusLabel.Text = "Search failed. The request function errored."
                    return
                end
                if not response or not response.Success then
                    statusLabel.Text = "Search failed. Bad response from ScriptBlox (Code: " .. (response and response.StatusCode or "N/A") .. ")"
                    return
                end

                statusLabel.Visible = false
                local resultsFound = 0
                for path, title in response.Body:gmatch('href="(/script/[^"]+)" class="script-card-title">([^<]+)</a>') do
                    resultsFound = resultsFound + 1
                    local newResult = resultTemplate:Clone()
                    newResult.Parent = resultsScroller
                    newResult.Title.Text = title:gsub("&#39;", "'"):gsub("&quot;", '"'):gsub("&amp;", "&")
                    newResult.ExecButton.MouseButton1Click:Connect(function() executeScript(path) end)
                    newResult.Visible = true
                end

                if resultsFound == 0 then
                    statusLabel.Visible = true
                    statusLabel.Text = "No results found for that query."
                end
            end)
        end
        
        searchBtn.MouseButton1Click:Connect(handleSearch)
        searchBox.FocusLost:Connect(function(enterPressed)
            if enterPressed then handleSearch() end
        end)
    end
end

-- ========== Commands Page (grid layout) ========== 
do
    local page = CommandsPage
    local grid = Instance.new("Frame", page)
    grid.Size = UDim2.new(1, -20, 1, -20)
    grid.Position = UDim2.new(0, 10, 0, 10)
    grid.BackgroundTransparency = 1

    local function colX(i) return 12 + (i-1) * 170 end
    local function rowY(r) return (r-1) * 48 end

    -- State vars + connections
    local noclipOn = false
    local noclipConn = nil

    local flyOn = false
    local flyConn = nil
    local flySpeed = 60

    local speedOn = false
    local defaultWalk = 16
    local walkSpeed = 50

    local infJump = false

    local tpCtrlOn = false

    -- Anti-Fling
    local antiFlingOn = false
    local antiConn = nil
    local velocityThreshold = 120
    local displacementThreshold = 25
    local restoreDelay = 0.06
    local lastSafeCFrame = nil
    local lastSafeTime = tick()
    local restoreCooldown = 0.5
    local killForceClasses = {
        "BodyVelocity","BodyForce","BodyGyro","BodyAngularVelocity",
        "VectorForce","AlignPosition","AlignOrientation","LinearVelocity","AngularVelocity"
    }

    -- Utility: remove force objects from a character (best-effort)
    local function removeForceObjectsFromCharacter(char)
        if not char then return end
        for _, obj in ipairs(char:GetDescendants()) do
            if obj:IsA("BasePart") then
                for _, child in ipairs(obj:GetChildren()) do
                    if table.find(killForceClasses, child.ClassName) then
                        pcall(function() child:Destroy() end)
                    end
                end
            else
                if table.find(killForceClasses, obj.ClassName) then
                    pcall(function() obj:Destroy() end)
                end
            end
        end
    end

    local function restoreCharacterToSafe(char)
        if not char then return end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        if not lastSafeCFrame then return end
        if (tick() - lastSafeTime) < restoreCooldown then return end
        pcall(function()
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum then hum.PlatformStand = true end
            hrp.Velocity = Vector3.new(0,0,0)
            hrp.CFrame = lastSafeCFrame
            task.wait(restoreDelay)
            if hum then hum.PlatformStand = false end
            removeForceObjectsFromCharacter(char)
        end)
        lastSafeTime = tick()
    end

    local function isVelocitySuspicious(vec)
        return vec.Magnitude >= velocityThreshold
    end
    
    local function isDisplacementSuspicious(oldCF, newCF)
        if not oldCF or not newCF then return false end
        return (oldCF.Position - newCF.Position).Magnitude >= displacementThreshold
    end

    local function startAntiFling()
        if antiConn then pcall(function() antiConn:Disconnect() end) end
        antiConn = RunService.Heartbeat:Connect(function()
            if not antiFlingOn then return end
            local char = LocalPlayer.Character
            if not char then return end
            local hrp = char:FindFirstChild("HumanoidRootPart")
            local hum = char:FindFirstChildOfClass("Humanoid")
            if not hrp or not hum then return end

            -- strip force objects frequently
            removeForceObjectsFromCharacter(char)

            -- track safe cframe when stable
            local vel = hrp.AssemblyLinearVelocity or hrp.Velocity or (Vector3 and Vector3.new() or Vector3.new(0,0,0))
            local stable = (vel.Magnitude < (velocityThreshold * 0.25)) and (not hum.PlatformStand) and hum.Health > 0
            if stable then
                lastSafeCFrame = hrp.CFrame
                lastSafeTime = (typeof(tick) == "function" and tick() or os.clock())
            end

            if isVelocitySuspicious(vel) then
                pcall(function() hrp.Velocity = (Vector3 and Vector3.new(0,0,0) or Vector3.new(0,0,0)) end)
                restoreCharacterToSafe(char)
                removeForceObjectsFromCharacter(char)
            else
                if lastSafeCFrame and isDisplacementSuspicious(lastSafeCFrame, hrp.CFrame) then
                    restoreCharacterToSafe(char)
                end
            end
        end)
    end

    local function stopAntiFling()
        if antiConn then pcall(function() antiConn:Disconnect() end) end
        antiConn = nil
    end

    -- Command template slot 1
    local cmdBtn1 = makeButton(grid, "Server Finder +", UDim2.new(0,160,0,34), UDim2.new(0, colX(1), 0, rowY(1)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Pnsdgsa/Script-kids/refs/heads/main/Advanced%20Server%20Hop.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 2
    local cmdBtn2 = makeButton(grid, "Copy Console", UDim2.new(0,160,0,34), UDim2.new(0, colX(2), 0, rowY(1)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/scriptlisenbe-stack/luaprojectse3/refs/heads/main/consolecopy.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 3
    local cmdBtn3 = makeButton(grid, "Universe Viewer", UDim2.new(0,160,0,34), UDim2.new(0, colX(3), 0, rowY(2)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/ltseverydayyou/uuuuuuu/main/Universe%20Viewer"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 4
    local cmdBtn4 = makeButton(grid, "Exploit Maker (REM)", UDim2.new(0,160,0,34), UDim2.new(0, colX(1), 0, rowY(2)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://e-vil.com/anbu/rem.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 5
    local cmdBtn5 = makeButton(grid, "Working Chat Bypass", UDim2.new(0,160,0,34), UDim2.new(0, colX(2), 0, rowY(2)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/shadow62x/catbypass/main/upfix"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 6
    local cmdBtn7 = makeButton(grid, "IY Plugin Maker", UDim2.new(0,160,0,34), UDim2.new(0, colX(1), 0, rowY(3)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/scriptlisenbe-stack/luaprojectse3/refs/heads/main/iypluginmaker.txt"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 7
    local cmdBtn8 = makeButton(grid, "Infinite Yield", UDim2.new(0,160,0,34), UDim2.new(0, colX(2), 0, rowY(3)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 8
    local cmdBtn9 = makeButton(grid, "Chat Spy", UDim2.new(0,160,0,34), UDim2.new(0, colX(3), 0, rowY(3)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dehoisted/Chat-Spy/refs/heads/main/source/main.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 9
    local cmdBtn10 = makeButton(grid, "AntiCheatBypass", UDim2.new(0,160,0,34), UDim2.new(0, colX(1), 0, rowY(4)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Defy-cloud/Scripts/refs/heads/main/ACBPSOPENSOURCE"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 10
    local cmdBtn11 = makeButton(grid, "Blox Fruits Auto", UDim2.new(0,160,0,34), UDim2.new(0, colX(2), 0, rowY(4)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 11
    local cmdBtn12 = makeButton(grid, "XVC", UDim2.new(0,160,0,34), UDim2.new(0, colX(3), 0, rowY(4)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://pastebin.com/raw/Piw5bqGq"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 12
    local cmdBtn13 = makeButton(grid, "Reach Script", UDim2.new(0,160,0,34), UDim2.new(0, colX(1), 0, rowY(5)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Anaszaxo555/Y/refs/heads/main/Y"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)


    -- Command template slot 13
    local cmdBtn14 = makeButton(grid, "SpiritsHub V1", UDim2.new(0,160,0,34), UDim2.new(0, colX(2), 0, rowY(5)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://pastebin.com/raw/3Vc94qix"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)
	
    -- Command template slot 14
    local cmdBtn15 = makeButton(grid, "Script Search", UDim2.new(0,160,0,34), UDim2.new(0, colX(3), 0, rowY(5)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/ltseverydayyou/Nameless-Admin/main/ScriptHubNA.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 15
    local cmdBtn16 = makeButton(grid, "Wall Walk", UDim2.new(0,160,0,34), UDim2.new(0, colX(1), 0, rowY(6)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/ltseverydayyou/uuuuuuu/main/WallWalk.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 16
    local cmdBtn17 = makeButton(grid, "Moon's Notepad", UDim2.new(0,160,0,34), UDim2.new(0, colX(2), 0, rowY(6)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/UltramixSecondDev/BetterViewer/refs/heads/main/BetterViewer.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 17
    local cmdBtn18 = makeButton(grid, "Remote Spy, by cherry :)", UDim2.new(0,160,0,34), UDim2.new(0, colX(3), 0, rowY(6)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/InfernusScripts/Ketamine/refs/heads/main/Ketamine.lua"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 18
    local cmdBtn19 = makeButton(grid, "ZombUpd3", UDim2.new(0,160,0,34), UDim2.new(0, colX(1), 0, rowY(7)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/scriptlisenbe-stack/luaprojectse3/refs/heads/main/ZGUI.txt"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- Command template slot 19
    local cmdBtn20 = makeButton(grid, "HyperLib UI", UDim2.new(0,160,0,34), UDim2.new(0, colX(2), 0, rowY(7)), function()
        local ok, err = pcall(function()
            loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-Open-Source-Hyperlib-41040"))();
        end)
        if ok then
            notify("Zuka Hub", "Command Success", 2)
        else
            notify("Zuka Hub", "Failed to load: " .. tostring(err), 4)
        end
    end)

    -- === Anti-Fling System (refined) ===
    local antiBtn = makeButton(grid, "Anti-Fling: Off", UDim2.new(0,160,0,34), UDim2.new(0, colX(3), 0, rowY(1)), function(self)
        antiFlingOn = not antiFlingOn
        self.Text = "Anti-Fling: " .. (antiFlingOn and "On" or "Off")

        if antiFlingOn then
            startAntiFling()
            notify("Zuka Hub", "Anti-Fling enabled", 2)
        else
            stopAntiFling()
            notify("Zuka Hub", "Anti-Fling disabled", 2)
        end
    end)

    -- === Config Boxes ===
    local velBox = Instance.new("TextBox", grid)
    velBox.Size = UDim2.new(0,80,0,24)
    velBox.Position = UDim2.new(0, colX(4)+10, 0, rowY(1) + 8)
    velBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
    velBox.TextColor3 = Color3.fromRGB(255,255,255)
    velBox.Font = Enum.Font.Code
    velBox.TextSize = 14
    velBox.Text = tostring(velocityThreshold)
    makeUICorner(velBox, 6)

    velBox.FocusLost:Connect(function()
        local v = tonumber(velBox.Text)
        if v and v > 0 then
            velocityThreshold = v
            notify("Zuka Hub", "Velocity threshold = " .. v, 2)
        else
            velBox.Text = tostring(velocityThreshold)
        end
    end)

    local disBox = Instance.new("TextBox", grid)
    disBox.Size = UDim2.new(0,80,0,24)
    disBox.Position = UDim2.new(0, colX(4)+10, 0, rowY(1) + 40)
    disBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
    disBox.TextColor3 = Color3.fromRGB(255,255,255)
    disBox.Font = Enum.Font.Code
    disBox.TextSize = 14
    disBox.Text = tostring(displacementThreshold)
    makeUICorner(disBox, 6)

    disBox.FocusLost:Connect(function()
        local v = tonumber(disBox.Text)
        if v and v > 0 then
            displacementThreshold = v
            notify("Zuka Hub", "Displacement threshold = " .. v, 2)
        else
            disBox.Text = tostring(displacementThreshold)
        end
    end)

    -- Clean up connections when character spawns
    Players.LocalPlayer.CharacterAdded:Connect(function(char)
        task.wait(0.8)
        if noclipOn then
            -- ensure noclip re-applies for new character
            if noclipConn then pcall(function() noclipConn:Disconnect() end) end
            noclipConn = RunService.Stepped:Connect(function()
                if LocalPlayer.Character then
                    for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
                        if part:IsA("BasePart") and part.CanCollide then
                            part.CanCollide = false
                        end
                    end
                end
            end)
        end
        if antiFlingOn then
            removeForceObjectsFromCharacter(char)
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if hrp then lastSafeCFrame = hrp.CFrame; lastSafeTime = tick() end
        end
    end)

    -- Clean up on hub close: attempt to restore WalkSpeed and disconnect connections
    local function cleanupAll()
        if noclipConn then pcall(function() noclipConn:Disconnect() end); noclipConn = nil end
        if flyConn then pcall(function() flyConn:Disconnect() end); flyConn = nil end
        if antiConn then pcall(function() antiConn:Disconnect() end); antiConn = nil end
        -- restore walkspeed
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            pcall(function()
                LocalPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = defaultWalk
            end)
        end
    end

    -- Attach cleanup to CloseBtn
    CloseBtn.MouseButton1Click:Connect(function()
        cleanupAll()
        if getgenv().ZukaLuaHub then pcall(function() getgenv().ZukaLuaHub:Destroy() end); getgenv().ZukaLuaHub = nil end
    end)
end -- end Commands block

-- ========== Special Page (Script Hub) ========== 
do
    local page = SpecialPage
    local title = Instance.new("TextLabel", page)
    title.Size = UDim2.new(1, -20, 0, 36)
    title.Position = UDim2.new(0, 10, 0, 10)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(200,220,255)
    title.Font = Enum.Font.Code
    title.TextSize = 22
    title.Text = "Powerful Shit"
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextYAlignment = Enum.TextYAlignment.Center

    local desc = Instance.new("TextLabel", page)
    desc.Size = UDim2.new(1, -20, 0, 22)
    desc.Position = UDim2.new(0, 10, 0, 50)
    desc.BackgroundTransparency = 1
    desc.TextColor3 = Color3.fromRGB(180,180,200)
    desc.Font = Enum.Font.Code
    desc.TextSize = 15
    desc.Text = "when in doubt, whip it out."
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.TextYAlignment = Enum.TextYAlignment.Center

    local scripts = {
        {name = "Dex ++", url = "https://raw.githubusercontent.com/scriptlisenbe-stack/luaprojectse3/refs/heads/main/CustomDex.lua"},
        {name = "FE Admin", url = "https://raw.githubusercontent.com/scriptlisenbe-stack/luaprojectse3/refs/heads/main/PrivateConfigCustom.lua"},
        {name = "Zenith's Keyless Hub", url = "https://raw.githubusercontent.com/Zenith-Devs/Zenith-Hub/main/loader"},
        {name = "UNC Tester", url = "https://raw.githubusercontent.com/scriptlisenbe-stack/luaprojectse3/refs/heads/main/Universal-Script-UNC-Test-13114.lua"},
        {name = "Pentest B)", url = "https://raw.githubusercontent.com/scriptlisenbe-stack/luaprojectse3/refs/heads/main/RemoteEvent_Pentester_OP.txt"},
    }

    local function makeScriptButton(parent, text, url, y)
        return makeButton(parent, text, UDim2.new(0, 260, 0, 36), UDim2.new(0, 20, 0, y), function()
            local ok, err = pcall(function()
                loadstring(game:HttpGet(url))();
            end)
            if ok then
                notify("Script Hub", text .. " loaded!", 2)
            else
                notify("Script Hub", "Failed: " .. tostring(err), 4)
            end
        end)
    end

    -- Player List Section (side by side with scripts)
    local scriptPanelWidth = 300
    local playerPanelWidth = 260
    local panelTop = 80
    local playerPanelHeight = 180 -- Reduced height for player list
    local scannerPanelHeight = 120 -- Height for tool scanner
    local panelHeight = math.max(44 * #scripts + 36, playerPanelHeight + scannerPanelHeight + 12)

    -- Move script buttons into a frame for layout
    local scriptPanel = Instance.new("Frame", page)
    scriptPanel.Size = UDim2.new(0, scriptPanelWidth, 0, panelHeight)
    scriptPanel.Position = UDim2.new(0, 20, 0, panelTop)
    scriptPanel.BackgroundTransparency = 1
    scriptPanel.BorderSizePixel = 0

    for i, script in ipairs(scripts) do
        makeScriptButton(scriptPanel, script.name, script.url, 8 + (i-1)*44)
    end

    -- Player list panel (reduced height)
    local playerPanel = Instance.new("Frame", page)
    playerPanel.Size = UDim2.new(0, playerPanelWidth, 0, playerPanelHeight)
    playerPanel.Position = UDim2.new(0, 36 + scriptPanelWidth, 0, panelTop)
    playerPanel.BackgroundTransparency = 1
    playerPanel.BorderSizePixel = 0

    local playerListLabel = Instance.new("TextLabel", playerPanel)
    playerListLabel.Size = UDim2.new(0, 120, 0, 22)
    playerListLabel.Position = UDim2.new(0, 0, 0, 0)
    playerListLabel.BackgroundTransparency = 1
    playerListLabel.Text = "Players:"
    playerListLabel.TextColor3 = Color3.fromRGB(180,220,255)
    playerListLabel.Font = Enum.Font.Code
    playerListLabel.TextSize = 16
    playerListLabel.TextXAlignment = Enum.TextXAlignment.Left
    playerListLabel.TextYAlignment = Enum.TextYAlignment.Center

    local refreshBtn = makeButton(playerPanel, "Refresh", UDim2.new(0, 80, 0, 22), UDim2.new(0, 130, 0, 0), function() end)
    refreshBtn.TextSize = 14

    local playerScroller = Instance.new("ScrollingFrame", playerPanel)
    playerScroller.Size = UDim2.new(1, 0, 1, -28)
    playerScroller.Position = UDim2.new(0, 0, 0, 28)
    playerScroller.BackgroundColor3 = Color3.fromRGB(24,24,32)
    playerScroller.BackgroundTransparency = 0.08
    playerScroller.BorderSizePixel = 0
    playerScroller.ScrollBarThickness = 6
    playerScroller.AutomaticCanvasSize = Enum.AutomaticSize.Y
    playerScroller.CanvasSize = UDim2.new(0,0,0,0)
    playerScroller.ClipsDescendants = true
    makeUICorner(playerScroller, 6)

    local function refreshPlayerList()
        for _, child in ipairs(playerScroller:GetChildren()) do
            if child:IsA("Frame") or child:IsA("TextButton") or child:IsA("TextLabel") then child:Destroy() end
        end
        local y = 0
        for _, plr in ipairs(Players:GetPlayers()) do
            local row = Instance.new("Frame", playerScroller)
            row.Size = UDim2.new(1, -8, 0, 22)
            row.Position = UDim2.new(0, 4, 0, y)
            row.BackgroundTransparency = 1
            row.BorderSizePixel = 0

            local btn = Instance.new("TextButton", row)
            btn.Size = UDim2.new(0.6, -4, 1, 0)
            btn.Position = UDim2.new(0, 0, 0, 0)
            btn.BackgroundColor3 = Color3.fromRGB(30,30,40)
            btn.BackgroundTransparency = 0.15
            btn.Text = plr.DisplayName .. " (" .. plr.Name .. ")"
            btn.TextColor3 = Color3.fromRGB(220,220,255)
            btn.Font = Enum.Font.Code
            btn.TextSize = 14
            btn.TextXAlignment = Enum.TextXAlignment.Left
            btn.TextYAlignment = Enum.TextYAlignment.Center
            btn.AutoButtonColor = true
            makeUICorner(btn, 5)
            btn.MouseButton1Click:Connect(function()
                if setclipboard then
                    setclipboard(plr.Name)
                    notify("Player List", "Copied: " .. plr.Name, 2)
                else
                    notify("Player List", "setclipboard not supported", 2)
                end
            end)

            local tpBtn = Instance.new("TextButton", row)
            tpBtn.Size = UDim2.new(0.4, -4, 1, 0)
            tpBtn.Position = UDim2.new(0.6, 4, 0, 0)
            tpBtn.BackgroundColor3 = Color3.fromRGB(60,100,180)
            tpBtn.BackgroundTransparency = 0.08
            tpBtn.Text = "Teleport"
            tpBtn.TextColor3 = Color3.fromRGB(255,255,255)
            tpBtn.Font = Enum.Font.Code
            tpBtn.TextSize = 13
            tpBtn.AutoButtonColor = true
            makeUICorner(tpBtn, 5)
            tpBtn.MouseButton1Click:Connect(function()
                local char = LocalPlayer.Character
                if char and char:FindFirstChild("HumanoidRootPart") and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    char.HumanoidRootPart.CFrame = plr.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
                    notify("Player List", "Teleported to " .. plr.Name, 2)
                else
                    notify("Player List", "Teleport failed", 2)
                end
            end)
            y = y + 26
        end
        playerScroller.CanvasSize = UDim2.new(0,0,0,math.max(y,80))
    end

    refreshBtn.MouseButton1Click:Connect(refreshPlayerList)
    refreshPlayerList()

    -- === Tool Scanner Section (now under player list) ===
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Workspace = game:GetService("Workspace")

    local scannerPanel = Instance.new("Frame", page)
    scannerPanel.Size = UDim2.new(0, playerPanelWidth, 0, scannerPanelHeight)
    scannerPanel.Position = UDim2.new(0, 36 + scriptPanelWidth, 0, panelTop + playerPanelHeight + 8)
    scannerPanel.BackgroundTransparency = 1
    scannerPanel.BorderSizePixel = 0

    local scannerLabel = Instance.new("TextLabel", scannerPanel)
    scannerLabel.Size = UDim2.new(1, 0, 0, 22)
    scannerLabel.Position = UDim2.new(0, 0, 0, 0)
    scannerLabel.BackgroundTransparency = 1
    scannerLabel.Text = "Tool Scanner:"
    scannerLabel.TextColor3 = Color3.fromRGB(180,220,255)
    scannerLabel.Font = Enum.Font.Code
    scannerLabel.TextSize = 16
    scannerLabel.TextXAlignment = Enum.TextXAlignment.Left
    scannerLabel.TextYAlignment = Enum.TextYAlignment.Center

    local scanBtn = makeButton(scannerPanel, "Scan for Tools", UDim2.new(0, 120, 0, 22), UDim2.new(0, 0, 0, 28), function() end)
    scanBtn.TextSize = 14

    local resultBox = Instance.new("TextLabel", scannerPanel)
    resultBox.Size = UDim2.new(1, -8, 1, -60)
    resultBox.Position = UDim2.new(0, 4, 0, 56)
    resultBox.BackgroundColor3 = Color3.fromRGB(24,24,32)
    resultBox.BackgroundTransparency = 0.08
    resultBox.TextColor3 = Color3.fromRGB(220,220,255)
    resultBox.Font = Enum.Font.Code
    resultBox.TextSize = 14
    resultBox.TextXAlignment = Enum.TextXAlignment.Left
    resultBox.TextYAlignment = Enum.TextYAlignment.Top
    resultBox.Text = "Press scan to list tools."
    resultBox.ClipsDescendants = true
    resultBox.TextWrapped = true
    makeUICorner(resultBox, 6)

    local function scanForTools()
        local found = {}
        for _, container in ipairs({ReplicatedStorage, Workspace}) do
            for _, v in ipairs(container:GetChildren()) do
                if v:IsA("Tool") then
                    table.insert(found, v.Name)
                end
            end
        end
        if #found > 0 then
            resultBox.Text = "Tools found:\n" .. table.concat(found, "\n")
        else
            resultBox.Text = "No tools found in ReplicatedStorage or Workspace."
        end
    end

    scanBtn.MouseButton1Click:Connect(scanForTools)
end

-- Minimize behavior
local minimized = false
local minimizedSize = UDim2.new(0, 320, 0, 36)
local normalSize = UDim2.new(0, 740, 0, 420)

local function animateMinimize(minimize)
    if minimize then
        PagesArea.Visible = false
        TabsColumn.Visible = false
        MinBtn.Text = "+"
        -- Animate only the size, keep position
        TweenService:Create(MainFrame, TweenInfo.new(0.22, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = minimizedSize
        }):Play()
    else
        PagesArea.Visible = true
        TabsColumn.Visible = true
        MinBtn.Text = "￢ﾀﾓ" -- Patched: Use consistent character
        TweenService:Create(MainFrame, TweenInfo.new(0.22, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = normalSize
        }):Play()
        -- ensure current page is visible (default Editor)
        switchPage("Editor")
    end
end

MinBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    animateMinimize(minimized)
end)

-- On load, ensure MinBtn is correct
MinBtn.Text = minimized and "+" or "￢ﾀﾓ" -- Patched: Use consistent character


-- Final notification
notify("Zuka Hub", "Loaded ￢ﾀﾓ We're So Back.", 3)
-- === Secure Access Code Prompt ===
local ACCESS_CODES = {
    ["root"] = true, -- Replace with your code
    ["root"] = true,  -- Add more codes for friends
    ["root"] = true
}
local function showAccessPrompt()
    local sg = Instance.new("ScreenGui")
    sg.Name = "ZukaAccessPrompt"
    sg.ResetOnSpawn = false
    sg.Parent = game.CoreGui
    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0, 340, 0, 140)
    frame.Position = UDim2.new(0.5, -170, 0.5, -70)
    frame.BackgroundColor3 = Color3.fromRGB(30,30,40)
    frame.BorderSizePixel = 0
    local corner = Instance.new("UICorner", frame)
    corner.CornerRadius = UDim.new(0, 10)
    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(1, -24, 0, 36)
    label.Position = UDim2.new(0, 12, 0, 10)
    label.BackgroundTransparency = 1
    label.Text = "Developer Key"
    label.Font = Enum.Font.Code
    label.TextSize = 18
    label.TextColor3 = Color3.fromRGB(200,220,255)
    label.TextXAlignment = Enum.TextXAlignment.Left
    local box = Instance.new("TextBox", frame)
    box.Size = UDim2.new(1, -24, 0, 36)
    box.Position = UDim2.new(0, 12, 0, 56)
    box.BackgroundColor3 = Color3.fromRGB(40,40,60)
    box.TextColor3 = Color3.fromRGB(255,255,255)
    box.Font = Enum.Font.Code
    box.TextSize = 18
    box.PlaceholderText = "Enter Key.."
    box.Text = ""
    local okBtn = Instance.new("TextButton", frame)
    okBtn.Size = UDim2.new(0, 120, 0, 32)
    okBtn.Position = UDim2.new(1, -132, 1, -42)
    okBtn.BackgroundColor3 = Color3.fromRGB(60,120,200)
    okBtn.TextColor3 = Color3.fromRGB(255,255,255)
    okBtn.Font = Enum.Font.Code
    okBtn.TextSize = 16
    okBtn.Text = "Enter"
    local okCorner = Instance.new("UICorner", okBtn)
    okCorner.CornerRadius = UDim.new(0, 6)
    local result = Instance.new("TextLabel", frame)
    result.Size = UDim2.new(1, -24, 0, 20)
    result.Position = UDim2.new(0, 12, 1, -20)
    result.BackgroundTransparency = 1
    result.Text = ""
    result.Font = Enum.Font.Code
    result.TextSize = 14
    result.TextColor3 = Color3.fromRGB(255,80,80)
    result.TextXAlignment = Enum.TextXAlignment.Left
    local accessGranted = false
    local function tryAccess()
        local code = box.Text
        if ACCESS_CODES[code] then
            accessGranted = true
            sg:Destroy()
        else
            result.Text = "Wrong code. Try again."
        end
    end
    okBtn.MouseButton1Click:Connect(tryAccess)
    box.FocusLost:Connect(function(enter)
        if enter then tryAccess() end
    end)
    repeat wait() until accessGranted
end

showAccessPrompt()

--[[
    @Author: Zuka Tech
    @Date: 11/3/2025 (Final Version)
    @Description: A modular, client-sided chat command system for Zuka in Roblox.
]]

--==============================================================================
-- Services & Setup
--==============================================================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- Executor/Environment Dependencies
local function DoNotif(message, duration) print("NOTIFICATION: " .. tostring(message) .. " (for " .. tostring(duration) .. "s)") end
local function NaProtectUI(gui) if gui then gui.Parent = CoreGui or LocalPlayer:WaitForChild("PlayerGui") end; print("UI Protection applied to: " .. gui.Name) end
if not setclipboard then setclipboard = function(text) print("Clipboard (fallback): " .. text); DoNotif("setclipboard is not available. See console for output.", 5) end end

--==============================================================================
-- Configuration
--==============================================================================
local Prefix = ";"
local Commands = {}
local Modules = {}
local CommandInfo = {} -- For ;cmds UI

--==============================================================================
-- Core Modules (Condensed for brevity, no logic changed)
--==============================================================================
Modules.Fly = { State = { IsActive = false, Speed = 75, SprintMultiplier = 2.5, Connections = {}, BodyMovers = {} } }; function Modules.Fly:SetSpeed(s) local n = tonumber(s); if n and n > 0 then self.State.Speed = n; DoNotif("Fly speed set to: " .. n, 3) else DoNotif("Invalid speed.", 3) end end; function Modules.Fly:Disable() if not self.State.IsActive then return end; self.State.IsActive = false; local h = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid"); if h then h.PlatformStand = false end; for _, m in pairs(self.State.BodyMovers) do if m.Parent then m:Destroy() end end; for _, c in ipairs(self.State.Connections) do c:Disconnect() end; table.clear(self.State.BodyMovers); table.clear(self.State.Connections); DoNotif("Fly disabled.", 3) end; function Modules.Fly:Enable() if self.State.IsActive then return end; local c = LocalPlayer.Character; if not c or not c.HumanoidRootPart or not c:FindFirstChildOfClass("Humanoid") then DoNotif("Character required.", 3); return end; self.State.IsActive = true; DoNotif("Fly Enabled.", 3); local h, hrp = c.Humanoid, c.HumanoidRootPart; h.PlatformStand = true; local g = Instance.new("BodyGyro", hrp); g.MaxTorque = Vector3.new(9e9, 9e9, 9e9); g.P = 20000; local v = Instance.new("BodyVelocity", hrp); v.MaxForce = Vector3.new(9e9, 9e9, 9e9); self.State.BodyMovers.Gyro, self.State.BodyMovers.Velocity = g, v; local k = {}; local function onInput(i, gp) if not gp then k[i.KeyCode] = (i.UserInputState == Enum.UserInputState.Begin) end end; table.insert(self.State.Connections, UserInputService.InputBegan:Connect(onInput)); table.insert(self.State.Connections, UserInputService.InputEnded:Connect(onInput)); local l = RunService.RenderStepped:Connect(function() if not self.State.IsActive or not hrp.Parent then return end; local cam = workspace.CurrentCamera; g.CFrame = cam.CFrame; local dir = Vector3.new(); if k[Enum.KeyCode.W] then dir += cam.CFrame.LookVector end; if k[Enum.KeyCode.S] then dir -= cam.CFrame.LookVector end; if k[Enum.KeyCode.D] then dir += cam.CFrame.RightVector end; if k[Enum.KeyCode.A] then dir -= cam.CFrame.RightVector end; if k[Enum.KeyCode.Space] or k[Enum.KeyCode.E] then dir += Vector3.yAxis end; if k[Enum.KeyCode.LeftControl] or k[Enum.KeyCode.Q] then dir -= Vector3.yAxis end; local s = k[Enum.KeyCode.LeftShift] and self.State.Speed * self.State.SprintMultiplier or self.State.Speed; v.Velocity = dir.Magnitude > 0 and dir.Unit * s or Vector3.zero end); table.insert(self.State.Connections, l) end; function Modules.Fly:Toggle() if self.State.IsActive then self:Disable() else self:Enable() end end
Modules.Noclip = { State = { IsActive = false, Connection = nil } }; function Modules.Noclip:Enable() if self.State.IsActive then return end; self.State.IsActive = true; self.State.Connection = RunService.Stepped:Connect(function() if LocalPlayer.Character then for _, p in ipairs(LocalPlayer.Character:GetDescendants()) do if p:IsA("BasePart") then p.CanCollide = false end end end end); DoNotif("Noclip enabled.", 3) end; function Modules.Noclip:Disable() if not self.State.IsActive then return end; self.State.IsActive = false; if self.State.Connection then self.State.Connection:Disconnect(); self.State.Connection = nil end; DoNotif("Noclip disabled.", 3) end; function Modules.Noclip:Toggle() if self.State.IsActive then self:Disable() else self:Enable() end end
Modules.ClickFling = { State = { IsActive = false, Connection = nil, UI = nil } }; function Modules.ClickFling:Disable() self.State.IsActive = false; if self.State.UI then self.State.UI:Destroy() end; if self.State.Connection then self.State.Connection:Disconnect() end; self.State.UI, self.State.Connection = nil, nil; DoNotif("ClickFling Disabled.", 3) end; function Modules.ClickFling:Enable() self:Disable(); self.State.IsActive = true; local u = Instance.new("ScreenGui"); u.Name = "ClickFlingUI"; NaProtectUI(u); self.State.UI = u; local b = Instance.new("TextButton", u); b.Size = UDim2.fromOffset(120, 40); b.Text = "ClickFling: ON"; b.Position = UDim2.new(0.5, -60, 0, 10); b.TextColor3 = Color3.new(1, 1, 1); b.Font = Enum.Font.GothamBold; b.BackgroundColor3 = Color3.fromRGB(40, 40, 40); Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8); b.MouseButton1Click:Connect(function() self.State.IsActive = not self.State.IsActive; b.Text = "ClickFling: " .. (self.State.IsActive and "ON" or "OFF") end); local function drag(o) local d, s, p; o.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then d, s, p = true, i.Position, o.Position; i.Changed:Connect(function() if i.UserInputState == Enum.UserInputState.End then d = false end end) end end); o.InputChanged:Connect(function(i) if (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) and d then local delta = i.Position - s; o.Position = UDim2.new(p.X.Scale, p.X.Offset + delta.X, p.Y.Scale, p.Y.Offset + delta.Y) end end) end; drag(b); self.State.Connection = LocalPlayer:GetMouse().Button1Down:Connect(function() if not self.State.IsActive then return end; local t = LocalPlayer:GetMouse().Target; local p = t and t.Parent and Players:GetPlayerFromCharacter(t.Parent); if not p or p == LocalPlayer then return end; local oh = workspace.FallenPartsDestroyHeight; workspace.FallenPartsDestroyHeight = math.huge; local c, h, hrp, tc, th, thrp = LocalPlayer.Character, LocalPlayer.Character.Humanoid, LocalPlayer.Character.HumanoidRootPart, p.Character, p.Character.Humanoid, p.Character.HumanoidRootPart; if not (c and h and hrp and tc and th and thrp) then return end; local op = hrp.CFrame; local v = Instance.new("BodyVelocity", hrp); v.MaxForce = Vector3.new(math.huge, math.huge, math.huge); local st = tick(); repeat hrp.CFrame = thrp.CFrame * CFrame.new(0, 2, 0); task.wait() until (tick() - st) > 0.2 or not p.Parent; v:Destroy(); hrp.CFrame = op; workspace.FallenPartsDestroyHeight = oh; DoNotif("Flinging " .. p.Name, 2) end); DoNotif("ClickFling Enabled.", 5) end
Modules.Reach = { State = { UI = nil } }; function Modules.Reach:_getTool() return (LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")) or (LocalPlayer:FindFirstChildOfClass("Backpack") and LocalPlayer.Backpack:FindFirstChildOfClass("Tool")) end; function Modules.Reach:Apply(reachType, size) if self.State.UI then self.State.UI:Destroy() end; local tool = self:_getTool(); if not tool then return DoNotif("No tool equipped.", 3) end; local parts = {}; for _, p in ipairs(tool:GetDescendants()) do if p:IsA("BasePart") then table.insert(parts, p) end end; if #parts == 0 then return DoNotif("Tool has no parts.", 3) end; local ui = Instance.new("ScreenGui"); ui.Name = "ReachPartSelector"; NaProtectUI(ui); self.State.UI = ui; local frame = Instance.new("Frame", ui); frame.Size = UDim2.fromOffset(250, 200); frame.Position = UDim2.new(0.5, -125, 0.5, -100); frame.BackgroundColor3 = Color3.fromRGB(35, 35, 45); Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8); local title = Instance.new("TextLabel", frame); title.Size = UDim2.new(1, 0, 0, 30); title.BackgroundTransparency = 1; title.Font = Enum.Font.Code; title.Text = "Select a Part"; title.TextColor3 = Color3.fromRGB(200, 220, 255); title.TextSize = 16; local scroll = Instance.new("ScrollingFrame", frame); scroll.Size = UDim2.new(1, -20, 1, -40); scroll.Position = UDim2.fromOffset(10, 35); scroll.BackgroundColor3 = frame.BackgroundColor3; scroll.BorderSizePixel = 0; scroll.ScrollBarThickness = 6; local layout = Instance.new("UIListLayout", scroll); layout.Padding = UDim.new(0, 5); for _, part in ipairs(parts) do local btn = Instance.new("TextButton", scroll); btn.Size = UDim2.new(1, 0, 0, 30); btn.BackgroundColor3 = Color3.fromRGB(50, 50, 65); btn.TextColor3 = Color3.fromRGB(220, 220, 230); btn.Font = Enum.Font.Code; btn.Text = part.Name; btn.TextSize = 14; Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4); btn.MouseButton1Click:Connect(function() if not part.Parent then ui:Destroy(); return DoNotif("Part gone.", 3) end; if not part:FindFirstChild("OGSize3") then local v = Instance.new("Vector3Value", part); v.Name = "OGSize3"; v.Value = part.Size end; if part:FindFirstChild("FunTIMES") then part.FunTIMES:Destroy() end; local sb = Instance.new("SelectionBox", part); sb.Adornee = part; sb.Name = "FunTIMES"; sb.LineThickness = 0.02; sb.Color3 = reachType == "box" and Color3.fromRGB(0,100,255) or Color3.fromRGB(255,0,0); if reachType == "box" then part.Size = Vector3.one * size else part.Size = Vector3.new(part.Size.X, part.Size.Y, size) end; part.Massless = true; ui:Destroy(); self.State.UI = nil; DoNotif("Applied reach.", 3) end) end end; function Modules.Reach:Reset() local tool = self:_getTool(); if not tool then return DoNotif("No tool to reset.", 3) end; for _, p in ipairs(tool:GetDescendants()) do if p:IsA("BasePart") then if p:FindFirstChild("OGSize3") then p.Size = p.OGSize3.Value; p.OGSize3:Destroy() end; if p:FindFirstChild("FunTIMES") then p.FunTIMES:Destroy() end end end; DoNotif("Tool reach reset.", 3) end
Modules.Aura = { State = { IsActive = false, Connection = nil, Visualizer = nil } }; function Modules.Aura:Disable() if not self.State.IsActive then return end; self.State.IsActive = false; if self.State.Connection then self.State.Connection:Disconnect() end; if self.State.Visualizer then self.State.Visualizer:Destroy() end; self.State.Connection, self.State.Visualizer = nil, nil; DoNotif("Aura disabled.", 3) end; function Modules.Aura:Enable(distance) if not firetouchinterest then return DoNotif("Aura unsupported.", 5) end; self:Disable(); self.State.IsActive = true; local dist = tonumber(distance) or 20; local viz = Instance.new("Part"); viz.Shape = Enum.PartType.Ball; viz.Size = Vector3.one * dist * 2; viz.Transparency = 0.8; viz.Color = Color3.fromRGB(255,0,0); viz.Material = Enum.Material.Neon; viz.Anchored = true; viz.CanCollide = false; viz.Parent = workspace; self.State.Visualizer = viz; local function getHandle() local c = LocalPlayer.Character; if not c then return end; local t = c:FindFirstChildOfClass("Tool"); return t and (t:FindFirstChild("Handle") or t:FindFirstChildWhichIsA("BasePart")) end; self.State.Connection = RunService.Heartbeat:Connect(function() local handle = getHandle(); local root = LocalPlayer.Character and LocalPlayer.Character.HumanoidRootPart; if not handle or not root then viz.CFrame = CFrame.new(0, -1000, 0); return end; viz.CFrame = root.CFrame; for _, plr in ipairs(Players:GetPlayers()) do if plr ~= LocalPlayer and plr.Character then local targetRoot = plr.Character:FindFirstChild("HumanoidRootPart"); local targetHum = plr.Character:FindFirstChildOfClass("Humanoid"); if targetRoot and targetHum and targetHum.Health > 0 and (targetRoot.Position - root.Position).Magnitude <= dist then firetouchinterest(handle, targetRoot, 0); firetouchinterest(handle, targetRoot, 1) end end end end); DoNotif("Aura enabled.", 3) end
Modules.CommandsUI = { State = { UI = nil } }; function Modules.CommandsUI:Toggle() if self.State.UI then self.State.UI:Destroy(); self.State.UI = nil; return end; local u = Instance.new("ScreenGui"); u.Name = "CommandsUI"; NaProtectUI(u); self.State.UI = u; local f = Instance.new("Frame", u); f.Size = UDim2.fromOffset(450, 300); f.Position = UDim2.new(0.5, -225, 0.5, -150); f.BackgroundColor3 = Color3.fromRGB(35, 35, 45); Instance.new("UICorner", f).CornerRadius = UDim.new(0, 8); local h = Instance.new("Frame", f); h.Size = UDim2.new(1, 0, 0, 32); h.BackgroundColor3 = Color3.fromRGB(25, 25, 35); local t = Instance.new("TextLabel", h); t.Size = UDim2.new(1, -30, 1, 0); t.Position = UDim2.fromOffset(10, 0); t.BackgroundTransparency = 1; t.Font = Enum.Font.Code; t.Text = "Zuka Commands"; t.TextColor3 = Color3.fromRGB(200, 220, 255); t.TextXAlignment = Enum.TextXAlignment.Left; t.TextSize = 16; local c = Instance.new("TextButton", h); c.Size = UDim2.fromOffset(32, 32); c.Position = UDim2.new(1, -32, 0, 0); c.BackgroundTransparency = 1; c.Font = Enum.Font.Code; c.Text = "X"; c.TextColor3 = Color3.fromRGB(200, 200, 220); c.TextSize = 20; c.MouseButton1Click:Connect(function() self:Toggle() end); local s = Instance.new("ScrollingFrame", f); s.Size = UDim2.new(1, -20, 1, -42); s.Position = UDim2.fromOffset(10, 37); s.BackgroundColor3 = f.BackgroundColor3; s.BorderSizePixel = 0; s.ScrollBarThickness = 6; local l = Instance.new("UIListLayout", s); l.Padding = UDim.new(0, 5); l.SortOrder = Enum.SortOrder.LayoutOrder; for _, info in ipairs(CommandInfo) do local text = Prefix .. info.Name; if #info.Aliases > 0 then text = text .. " (" .. table.concat(info.Aliases, ", ") .. ")" end; text = text .. " - " .. info.Description; local label = Instance.new("TextLabel", s); label.Size = UDim2.new(1, 0, 0, 20); label.BackgroundTransparency = 1; label.Font = Enum.Font.Code; label.Text = text; label.TextColor3 = Color3.fromRGB(220, 220, 230); label.TextSize = 14; label.TextXAlignment = Enum.TextXAlignment.Left; label.TextWrapped = true; label.AutomaticSize = Enum.AutomaticSize.Y end; local function drag(o) local d, s, p; o.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then d, s, p = true, i.Position, o.Position; i.Changed:Connect(function() if i.UserInputState == Enum.UserInputState.End then d = false end end) end end); o.InputChanged:Connect(function(i) if (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) and d then local delta = i.Position - s; o.Position = UDim2.new(p.X.Scale, p.X.Offset + delta.X, p.Y.Scale, p.Y.Offset + delta.Y) end end) end; drag(f) end

--==============================================================================
-- Command Bar Module (NEW)
--==============================================================================
Modules.CommandBar = { State = { UI = nil } }

function Modules.CommandBar:Toggle()
    if self.State.UI then
        self.State.UI:Destroy()
        self.State.UI = nil
        return
    end

    local ui = Instance.new("ScreenGui"); ui.Name = "CommandBarUI"; NaProtectUI(ui)
    self.State.UI = ui
    
    local bar = Instance.new("Frame", ui)
    bar.Size = UDim2.new(0, 450, 0, 32); bar.Position = UDim2.new(0.5, -225, 0, 10)
    bar.BackgroundColor3 = Color3.fromRGB(30, 30, 40); bar.BackgroundTransparency = 0.2
    Instance.new("UICorner", bar).CornerRadius = UDim.new(0, 6)
    
    local prefixLabel = Instance.new("TextLabel", bar)
    prefixLabel.Size = UDim2.new(0, 20, 1, 0); prefixLabel.Position = UDim2.fromOffset(5, 0)
    prefixLabel.BackgroundTransparency = 1; prefixLabel.Font = Enum.Font.Code
    prefixLabel.Text = Prefix; prefixLabel.TextColor3 = Color3.fromRGB(200, 220, 255); prefixLabel.TextSize = 18

    local textBox = Instance.new("TextBox", bar)
    textBox.Size = UDim2.new(1, -30, 1, 0); textBox.Position = UDim2.fromOffset(25, 0)
    textBox.BackgroundTransparency = 1; textBox.Font = Enum.Font.Code; textBox.Text = ""
    textBox.PlaceholderText = "Enter command..."; textBox.PlaceholderColor3 = Color3.fromRGB(150, 160, 180)
    textBox.TextColor3 = Color3.fromRGB(255, 255, 255); textBox.TextSize = 16
    textBox.ClearTextOnFocus = false
    
    textBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and textBox.Text:len() > 0 then
            processCommand(Prefix .. textBox.Text) -- Use the centralized processor
            textBox.Text = "" -- Clear after execution
        end
    end)
    
    -- Make it draggable
    local function drag(o) local d, s, p; o.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then d, s, p = true, i.Position, o.Position; i.Changed:Connect(function() if i.UserInputState == Enum.UserInputState.End then d = false end end) end end); o.InputChanged:Connect(function(i) if (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) and d then local delta = i.Position - s; o.Position = UDim2.new(p.X.Scale, p.X.Offset + delta.X, p.Y.Scale, p.Y.Offset + delta.Y) end end) end
    drag(bar)
    DoNotif("Command bar enabled.", 3)
end

--==============================================================================
-- Command Definitions
--==============================================================================
table.insert(CommandInfo, { Name = "cmds", Aliases = {"help"}, Description = "Shows this command list."}); table.insert(CommandInfo, { Name = "cmdbar", Aliases = {"cbar"}, Description = "Toggles the private command bar."}); table.insert(CommandInfo, { Name = "speed", Aliases = {}, Description = "Sets walkspeed. Usage: ;speed [num]"}); table.insert(CommandInfo, { Name = "fly", Aliases = {}, Description = "Toggles smooth flight mode."}); table.insert(CommandInfo, { Name = "flyspeed", Aliases = {}, Description = "Sets flight speed. Usage: ;flyspeed [num]"}); table.insert(CommandInfo, { Name = "noclip", Aliases = {}, Description = "Toggles walking through walls."}); table.insert(CommandInfo, { Name = "clickfling", Aliases = {"mousefling"}, Description = "Enables click to fling."}); table.insert(CommandInfo, { Name = "unclickfling", Aliases = {"unmousefling"}, Description = "Disables click to fling."}); table.insert(CommandInfo, { Name = "reach", Aliases = {"swordreach"}, Description = "Extends sword reach. Usage: ;reach [num]"}); table.insert(CommandInfo, { Name = "boxreach", Aliases = {}, Description = "Creates a box hitbox. Usage: ;boxreach [num]"}); table.insert(CommandInfo, { Name = "resetreach", Aliases = {"unreach"}, Description = "Resets tool reach to normal."}); table.insert(CommandInfo, { Name = "aura", Aliases = {}, Description = "Auto-hits nearby players. Usage: ;aura [dist]"}); table.insert(CommandInfo, { Name = "unaura", Aliases = {}, Description = "Disables aura."}); table.insert(CommandInfo, { Name = "iy", Aliases = {}, Description = "Loads the Infinite Yield admin panel."}); table.insert(CommandInfo, { Name = "cmdx", Aliases = {}, Description = "Loads the CMD-X admin panel."}); table.insert(CommandInfo, { Name = "remotespy", Aliases = {}, Description = "Opens a GUI for viewing game events."}); table.insert(CommandInfo, { Name = "dex", Aliases = {}, Description = "Opens the Dark Dex explorer for developers."})

-- Simple and Loadstring Commands
Commands.speed = function(args) local s = tonumber(args[1]); local h = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid"); if not h then DoNotif("Humanoid not found!", 3) return end; if s and s > 0 then h.WalkSpeed = s; DoNotif("WalkSpeed set to: " .. s, 3) else DoNotif("Invalid speed.", 3) end end
Commands.iy = function() pcall(function() loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))() end); DoNotif("Loading Infinite Yield...", 3) end
Commands.cmdx = function() pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/CMD-X/CMD-X/master/Source"))() end); DoNotif("Loading CMD-X...", 3) end
Commands.remotespy = function() pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/ex-ploi-ter/custom-remote-spy/main/source.lua"))() end); DoNotif("Loading Remote Spy...", 3) end
Commands.dex = function() pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Babyhamsta/RBLX_Scripts/main/Universal/Bypassed_Dark_Dex.lua"))() end); DoNotif("Loading Dark Dex...", 3) end

-- Command wrappers for modules
Commands.fly = function() Modules.Fly:Toggle() end; Commands.flyspeed = function(args) Modules.Fly:SetSpeed(args[1]) end; Commands.noclip = function() Modules.Noclip:Toggle() end; Commands.clickfling = function() Modules.ClickFling:Enable() end; Commands.unclickfling = function() Modules.ClickFling:Disable() end; Commands.cmds = function() Modules.CommandsUI:Toggle() end; Commands.reach = function(args) Modules.Reach:Apply("directional", tonumber(args[1]) or 15) end; Commands.boxreach = function(args) Modules.Reach:Apply("box", tonumber(args[1]) or 15) end; Commands.resetreach = function() Modules.Reach:Reset() end; Commands.aura = function(args) Modules.Aura:Enable(args[1]) end; Commands.unaura = function() Modules.Aura:Disable() end; Commands.cmdbar = function() Modules.CommandBar:Toggle() end

-- Command Aliases
Commands.help = Commands.cmds; Commands.mousefling = Commands.clickfling; Commands.unmousefling = Commands.unclickfling; Commands.swordreach = Commands.reach; Commands.unreach = Commands.resetreach; Commands.cbar = Commands.cmdbar

--==============================================================================
-- Centralized Command Processor (NEW)
--==============================================================================
function processCommand(message)
    if not message:sub(1, #Prefix) == Prefix then return end
    
    local args = {}
    for word in message:sub(#Prefix + 1):gmatch("%S+") do table.insert(args, word) end
    if #args == 0 then return end
    
    local cmdName = table.remove(args, 1):lower()
    local cmdFunc = Commands[cmdName]
    
    if cmdFunc then
        pcall(cmdFunc, args)
    else
        DoNotif("Unknown command: " .. cmdName, 3)
    end
end

--==============================================================================
-- Input Handlers
--==============================================================================
-- Public Chat Handler
LocalPlayer.Chatted:Connect(processCommand)

-- Toggle the command bar by default on start
Modules.CommandBar:Toggle()

DoNotif("Zuka Command Handler v5 (Loaded) | Prefix: '" .. Prefix .. "' | ;cmds for help", 6)